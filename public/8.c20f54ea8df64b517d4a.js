(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{tbzR:function(t,e,n){"use strict";n.d(e,"a",(function(){return Yd})),n.d(e,"b",(function(){return Xd}));var r=n("LoAr"),i=n("diMa"),o=n("HnWI"),s=n("iJR/"),a=n("pN2L"),u=n("W/Ou"),c=n("QagP"),h=n("Jg5f"),l=n("4S5C"),f=n("lqvn"),d=n("z5yO"),p=n("CxUu"),y=n("lykB"),v=n("WT9V"),g=n("xzNC"),m=n("e2bd"),b=n("B/oq"),w=n("Gjt8"),I=function(t,e){return(I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function E(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var T,_="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},S=S||{},N=_||self;function D(){}function A(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function O(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var k="closure_uid_"+(1e9*Math.random()>>>0),C=0;function x(t,e,n){return t.call.apply(t.bind,arguments)}function R(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function P(t,e,n){return(P=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?x:R).apply(null,arguments)}function L(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function M(){return Date.now()}function F(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Kb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function q(){this.j=this.j,this.i=this.i}q.prototype.j=!1,q.prototype.ja=function(){!this.j&&(this.j=!0,this.G(),0)&&function(t){Object.prototype.hasOwnProperty.call(t,k)&&t[k]||(t[k]=++C)}(this)},q.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var U=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},V=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function j(t){return Array.prototype.concat.apply([],arguments)}function B(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function K(t){return/^[\s\xa0]*$/.test(t)}var G,z=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Q(t,e){return-1!=t.indexOf(e)}function H(t,e){return t<e?-1:t>e?1:0}t:{var W=N.navigator;if(W){var Y=W.userAgent;if(Y){G=Y;break t}}G=""}function X(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function J(t){var e={};for(var n in t)e[n]=t[n];return e}var $="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Z(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<$.length;o++)n=$[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function tt(t){return tt[" "](t),t}tt[" "]=D;var et,nt,rt=Q(G,"Opera"),it=Q(G,"Trident")||Q(G,"MSIE"),ot=Q(G,"Edge"),st=ot||it,at=Q(G,"Gecko")&&!(Q(G.toLowerCase(),"webkit")&&!Q(G,"Edge"))&&!(Q(G,"Trident")||Q(G,"MSIE"))&&!Q(G,"Edge"),ut=Q(G.toLowerCase(),"webkit")&&!Q(G,"Edge");function ct(){var t=N.document;return t?t.documentMode:void 0}t:{var ht="",lt=(nt=G,at?/rv:([^\);]+)(\)|;)/.exec(nt):ot?/Edge\/([\d\.]+)/.exec(nt):it?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(nt):ut?/WebKit\/(\S+)/.exec(nt):rt?/(?:Version)[ \/]?(\S+)/.exec(nt):void 0);if(lt&&(ht=lt?lt[1]:""),it){var ft=ct();if(null!=ft&&ft>parseFloat(ht)){et=String(ft);break t}}et=ht}var dt={};function pt(t){return function(t,e){var n=dt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e()}(t,(function(){for(var e=0,n=z(String(et)).split("."),r=z(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=H(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||H(0==s[2].length,0==a[2].length)||H(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e}))}var yt=N.document&&it&&(ct()||parseInt(et,10))||void 0,vt=!it||9<=Number(yt),gt=it&&!pt("9"),mt=function(){if(!N.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{N.addEventListener("test",D,e),N.removeEventListener("test",D,e)}catch(n){}return t}();function bt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function wt(t,e){if(bt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(at){t:{try{tt(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:It[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}bt.prototype.b=function(){this.defaultPrevented=!0},F(wt,bt);var It={2:"touch",3:"pen",4:"mouse"};wt.prototype.b=function(){wt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,gt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}};var Et="closure_listenable_"+(1e6*Math.random()|0),Tt=0;function _t(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++Tt,this.Y=this.Z=!1}function St(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function Nt(t){this.src=t,this.a={},this.b=0}function Dt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=U(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(St(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function At(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}Nt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=At(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new _t(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Ot="closure_lm_"+(1e6*Math.random()|0),kt={};function Ct(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Ut(r),e&&e[Et]?e.wa(n,r,O(i)?!!i.capture:!!i,o):xt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Ct(t,e[o],n,r,i);return null}return n=Ut(n),t&&t[Et]?t.va(e,n,O(r)?!!r.capture:!!r,i):xt(t,e,n,!1,r,i)}function xt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=O(i)?!!i.capture:!!i;if(s&&!vt)return null;var a=Ft(t);if(a||(t[Ot]=a=new Nt(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Mt,e=vt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)mt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Pt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Rt(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[Et])Dt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Pt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ft(e))?(Dt(n,t),0==n.b&&(n.src=null,e[Ot]=null)):St(t)}}}function Pt(t){return t in kt?kt[t]:kt[t]="on"+t}function Lt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Rt(t),n.call(r,e)}function Mt(t,e){if(t.Y)return!0;if(!vt){if(!e)t:{e=["window","event"];for(var n=N,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Lt(t,e=new wt(e,this))}return Lt(t,new wt(e,this))}function Ft(t){return(t=t[Ot])instanceof Nt?t:null}var qt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ut(t){return"function"==typeof t?t:(t[qt]||(t[qt]=function(e){return t.handleEvent(e)}),t[qt])}function Vt(){q.call(this),this.c=new Nt(this),this.J=this,this.C=null}function jt(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e)e=new bt(e,t);else if(e instanceof bt)e.target=e.target||t;else{var i=e;Z(e=new bt(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.a=n[o];i=Bt(s,r,!0,e)&&i}if(i=Bt(s=e.a=t,r,!0,e)&&i,i=Bt(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=Bt(s=e.a=n[o],r,!1,e)&&i}function Bt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.Y&&s.capture==n){var a=s.listener,u=s.ca||s.src;s.Z&&Dt(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}F(Vt,q),Vt.prototype[Et]=!0,(T=Vt.prototype).addEventListener=function(t,e,n,r){Ct(this,t,e,n,r)},T.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=O(i)?!!i.capture:!!i,r=Ut(r),e&&e[Et]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=At(s=e.a[n],r,i,o))&&(St(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):e&&(e=Ft(e))&&(n=e.a[n.toString()],e=-1,n&&(e=At(n,r,i,o)),(r=-1<e?n[e]:null)&&Rt(r))}(this,t,e,n,r)},T.G=function(){if(Vt.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)St(n[r]);delete e.a[t],e.b--}}this.C=null},T.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},T.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Kt=N.JSON.stringify;function Gt(){this.b=this.a=null}var zt,Qt=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,this.a=(t=this.a).next,t.next=null):t=this.c(),t},t}())((function(){return new Wt}),(function(t){t.reset()}));function Ht(){var t=$t,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Wt(){this.next=this.b=this.a=null}function Yt(t){N.setTimeout((function(){throw t}),0)}function Xt(t,e){zt||function(){var t=N.Promise.resolve(void 0);zt=function(){t.then(Zt)}}(),Jt||(zt(),Jt=!0),$t.add(t,e)}Gt.prototype.add=function(t,e){var n=Qt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Wt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Wt.prototype.reset=function(){this.next=this.b=this.a=null};var Jt=!1,$t=new Gt;function Zt(){for(var t;t=Ht();){try{t.a.call(t.b)}catch(n){Yt(n)}var e=Qt;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}Jt=!1}function te(t,e){Vt.call(this),this.b=t||1,this.a=e||N,this.f=P(this.Za,this),this.g=M()}function ee(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function ne(t,e,n){if("function"==typeof t)n&&(t=P(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=P(t.handleEvent,t)}return 2147483647<Number(e)?-1:N.setTimeout(t,e||0)}function re(t){t.a=ne((function(){t.a=null,t.c&&(t.c=!1,re(t))}),t.h);var e=t.b;t.b=null,t.g.apply(null,e)}F(te,Vt),(T=te.prototype).aa=!1,T.M=null,T.Za=function(){if(this.aa){var t=M()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),jt(this,"tick"),this.aa&&(ee(this),this.start()))}},T.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=M())},T.G=function(){te.X.G.call(this),ee(this),delete this.a};var ie=function(t){function e(e,n){var r=t.call(this)||this;return r.g=e,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(t,e){function n(){this.constructor=t}I(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:re(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(N.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(q);function oe(t){q.call(this),this.b=t,this.a={}}F(oe,q);var se=[];function ae(t,e,n,r){Array.isArray(n)||(n&&(se[0]=n.toString()),n=se);for(var i=0;i<n.length;i++){var o=Ct(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function ue(t){X(t.a,(function(t,e){this.a.hasOwnProperty(e)&&Rt(t)}),t),t.a={}}function ce(){this.a=!0}function he(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Kt(n)}catch(a){return e}}(t,n)+(r?" "+r:"")}))}oe.prototype.G=function(){oe.X.G.call(this),ue(this)},oe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ce.prototype.info=function(){};var le={},fe=null;function de(){return fe=fe||new Vt}function pe(t){bt.call(this,le.Fa,t)}function ye(t){var e=de();jt(e,new pe(e,t))}function ve(t,e){bt.call(this,le.STAT_EVENT,t),this.stat=e}function ge(t){var e=de();jt(e,new ve(e,t))}function me(t){bt.call(this,le.Ga,t)}function be(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return N.setTimeout((function(){t()}),e)}le.Fa="serverreachability",F(pe,bt),le.STAT_EVENT="statevent",F(ve,bt),le.Ga="timingevent",F(me,bt);var we={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},Ie={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function Ee(){}function Te(){}Ee.prototype.a=null;var _e,Se={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function Ne(){bt.call(this,"d")}function De(){bt.call(this,"c")}function Ae(){}function Oe(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new oe(this),this.P=ke,this.R=new te(t=st?125:void 0),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}F(Ne,bt),F(De,bt),F(Ae,Ee),_e=new Ae;var ke=45e3,Ce={},xe={};function Re(t,e,n){t.H=1,t.i=en(Ye(e)),t.j=n,t.I=!0,Pe(t,null)}function Pe(t,e){t.u=M(),Fe(t),t.l=Ye(t.i);var n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),yn(n.b,"t",r),t.D=0,t.a=cr(t.g,t.g.C?e:null),0<t.O&&(t.F=new ie(P(t.Ca,t,t.a),t.O)),ae(t.J,t.a,"readystatechange",t.Xa),e=t.B?J(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),ye(1),function(t,e,n,r,i,o){t.info((function(){if(t.a)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s}))}(t.c,t.m,t.l,t.f,t.S,t.j)}function Le(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=Me(t,n);if(i==xe){4==e&&(t.h=4,ge(14),r=!1),he(t.c,t.f,null,"[Incomplete Response]");break}if(i==Ce){t.h=4,ge(15),he(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}he(t.c,t.f,i,null),Be(t,i)}4==e&&0==n.length&&(t.h=1,ge(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),er(e),e.F=!0,ge(11))):(he(t.c,t.f,n,"[Invalid Chunked Response]"),je(t),Ve(t))}function Me(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?xe:(n=Number(e.substring(n,r)),isNaN(n)?Ce:(r+=1)+n>e.length?xe:(e=e.substr(r,n),t.D=r+n,e))}function Fe(t){t.T=M()+t.P,qe(t,t.P)}function qe(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=be(P(t.Va,t),e)}function Ue(t){t.o&&(N.clearTimeout(t.o),t.o=null)}function Ve(t){0==t.g.v||t.A||ir(t.g,t)}function je(t){Ue(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,ee(t.R),ue(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Be(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||En(n.b,t)))if(n.I=t.N,!t.C&&En(n.b,t)&&3==n.v){try{var r=n.ka.a.parse(e)}catch(Wf){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;rr(n),Qn(n)}tr(n),ge(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=be(P(n.Sa,n),6e3));if(1>=In(n.b)&&n.ea){try{n.ea()}catch(Wf){}n.ea=void 0}}else sr(n,11)}else if((t.C||n.a==t)&&rr(n),!K(e))for(e=r=n.ka.a.parse(e),r=0;r<e.length;r++)if(n.P=(i=e[r])[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var o=i[3];null!=o&&(n.ha=o,n.c.info("VER="+n.ha));var s=i[4];null!=s&&(n.pa=s,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var c=t.a;if(c){var h=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=u.b;!l.a&&(Q(h,"spdy")||Q(h,"quic")||Q(h,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(Tn(l,l.b),l.b=null))}if(u.A){var f=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.na=f,tn(u.B,u.A,f))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=M()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((u=n).la=ur(u,u.C?u.ga:null,u.fa),d.C){_n(u.b,d);var p=d,y=u.D;y&&p.setTimeout(y),p.o&&(Ue(p),Fe(p)),u.a=d}else Zn(u);0<n.g.length&&Yn(n)}else"stop"!=i[0]&&"close"!=i[0]||sr(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?sr(n,7):zn(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);ye(4)}catch(Wf){}}function Ke(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(A(t)||"string"==typeof t)V(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(A(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(A(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ge(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ge)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function ze(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Qe(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Qe(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function Qe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(T=Oe.prototype).setTimeout=function(t){this.P=t},T.Xa=function(t){t=t.target;var e=this.F;e&&3==jn(t)?e.f():this.Ca(t)},T.Ca=function(t){try{if(t==this.a)t:{var e=jn(this.a),n=this.a.ua(),r=this.a.W();if(!(3>e||3==e&&!st&&!this.a.$())){this.A||4!=e||7==n||ye(8==n||0>=r?3:2),Ue(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,function(t,e,n,r,i,o,s){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s}))}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var s,a=this.a;if((s=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(s)){var u=s;break e}}u=null}if(!u){this.b=!1,this.h=3,ge(12),je(this),Ve(this);break t}he(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Be(this,u)}this.I?(Le(this,e,o),st&&this.b&&3==e&&(ae(this.J,this.R,"tick",this.Wa),this.R.start())):(he(this.c,this.f,o,null),Be(this,o)),4==e&&je(this),this.b&&!this.A&&(4==e?ir(this.g,this):(this.b=!1,Fe(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,ge(12)):(this.h=0,ge(13)),je(this),Ve(this)}}}catch(c){}},T.Wa=function(){if(this.a){var t=jn(this.a),e=this.a.$();this.D<e.length&&(Ue(this),Le(this,t,e),this.b&&4!=t&&Fe(this))}},T.cancel=function(){this.A=!0,je(this)},T.Va=function(){this.o=null;var t=M();0<=t-this.T?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.c,this.l),2!=this.H&&(ye(3),ge(17)),je(this),this.h=2,Ve(this)):qe(this,this.T-t)},(T=Ge.prototype).K=function(){ze(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},T.L=function(){return ze(this),this.a.concat()},T.get=function(t,e){return Qe(this.b,t)?this.b[t]:e},T.set=function(t,e){Qe(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},T.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var He=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function We(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof We){this.a=void 0!==e?e:t.a,Xe(this,t.f),this.j=t.j,Je(this,t.c),$e(this,t.h),this.g=t.g,e=t.b;var n=new ln;n.c=e.c,e.a&&(n.a=new Ge(e.a),n.b=e.b),Ze(this,n),this.i=t.i}else t&&(n=String(t).match(He))?(this.a=!!e,Xe(this,n[1]||"",!0),this.j=nn(n[2]||""),Je(this,n[3]||"",!0),$e(this,n[4]),this.g=nn(n[5]||"",!0),Ze(this,n[6]||"",!0),this.i=nn(n[7]||"")):(this.a=!!e,this.b=new ln(null,this.a))}function Ye(t){return new We(t)}function Xe(t,e,n){t.f=n?nn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Je(t,e,n){t.c=n?nn(e,!0):e}function $e(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Ze(t,e,n){e instanceof ln?(t.b=e,function(t,e){e&&!t.f&&(fn(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(dn(this,e),yn(this,n,t))}),t)),t.f=e}(t.b,t.a)):(n||(e=rn(e,cn)),t.b=new ln(e,t.a))}function tn(t,e,n){t.b.set(e,n)}function en(t){return tn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^M()).toString(36)),t}function nn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function rn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,on),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function on(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}We.prototype.toString=function(){var t=[],e=this.f;e&&t.push(rn(e,sn,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(rn(e,sn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(rn(n,"/"==n.charAt(0)?un:an,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",rn(n,hn)),t.join("")};var sn=/[#\/\?@]/g,an=/[#\?:]/g,un=/[#\?]/g,cn=/[#\?@]/g,hn=/#/g;function ln(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function fn(t){t.a||(t.a=new Ge,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function dn(t,e){fn(t),e=vn(t,e),Qe(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Qe((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&ze(t)))}function pn(t,e){return fn(t),e=vn(t,e),Qe(t.a.b,e)}function yn(t,e,n){dn(t,e),0<n.length&&(t.c=null,t.a.set(vn(t,e),B(n)),t.b+=n.length)}function vn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(T=ln.prototype).add=function(t,e){fn(this),this.c=null,t=vn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},T.forEach=function(t,e){fn(this),this.a.forEach((function(n,r){V(n,(function(n){t.call(e,n,r,this)}),this)}),this)},T.L=function(){fn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},T.K=function(t){fn(this);var e=[];if("string"==typeof t)pn(this,t)&&(e=j(e,this.a.get(vn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=j(e,t[n])}return e},T.set=function(t,e){return fn(this),this.c=null,pn(this,t=vn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},T.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},T.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var gn=function(){return function(t,e){this.b=t,this.a=e}}();function mn(t){this.g=t||bn,t=N.PerformanceNavigationTiming?0<(t=N.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(N.ia&&N.ia.ya&&N.ia.ya()&&N.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var bn=10;function wn(t){return!!t.b||!!t.a&&t.a.size>=t.f}function In(t){return t.b?1:t.a?t.a.size:0}function En(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function Tn(t,e){t.a?t.a.add(e):t.b=e}function _n(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Sn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=E(t.a.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.s)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return B(t.c)}function Nn(){}function Dn(){this.a=new Nn}function An(t,e,n){var r=n||"";try{Ke(t,(function(t,n){var i=t;O(t)&&(i=Kt(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(Od){throw e.push(r+"type="+encodeURIComponent("_badmap")),Od}}function On(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}mn.prototype.cancel=function(){var t,e;if(this.c=Sn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=E(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},Nn.prototype.stringify=function(t){return N.JSON.stringify(t,void 0)},Nn.prototype.parse=function(t){return N.JSON.parse(t,void 0)};var kn=N.JSON.parse;function Cn(t){Vt.call(this),this.headers=new Ge,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=xn,this.D=this.F=!1}F(Cn,Vt);var xn="",Rn=/^https?$/i,Pn=["POST","PUT"];function Ln(t){return"content-type"==t.toLowerCase()}function Mn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Fn(t),Un(t)}function Fn(t){t.u||(t.u=!0,jt(t,"complete"),jt(t,"error"))}function qn(t){if(t.b&&void 0!==S&&(!t.s[1]||4!=jn(t)||2!=t.W()))if(t.l&&4==jn(t))ne(t.za,0,t);else if(jt(t,"readystatechange"),4==jn(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.B).match(He)[1]||null;if(!o&&N.self&&N.self.location){var s=N.self.location.protocol;o=s.substr(0,s.length-1)}i=!Rn.test(o?o.toLowerCase():"")}e=i}if(e)jt(t,"complete"),jt(t,"success");else{t.h=6;try{var a=2<jn(t)?t.a.statusText:""}catch(n){a=""}t.f=a+" ["+t.W()+"]",Fn(t)}}finally{Un(t)}}}function Un(t,e){if(t.a){Vn(t);var n=t.a,r=t.s[0]?D:null;t.a=null,t.s=null,e||jt(t,"ready");try{n.onreadystatechange=r}catch(Od){}}}function Vn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(N.clearTimeout(t.m),t.m=null)}function jn(t){return t.a?t.a.readyState:0}function Bn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return X(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):tn(t,e,n))}function Kn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Gn(t){this.pa=0,this.g=[],this.c=new ce,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Kn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Kn("baseRetryDelayMs",5e3,t),this.Ra=Kn("retryDelaySeedMs",1e4,t),this.Ma=Kn("forwardChannelMaxRetries",2,t),this.ma=Kn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new mn(t&&t.concurrentRequestLimit),this.ka=new Dn,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function zn(t){if(Hn(t),3==t.v){var e=t.R++,n=Ye(t.B);tn(n,"SID",t.J),tn(n,"RID",e),tn(n,"TYPE","terminate"),Jn(t,n),(e=new Oe(t,t.c,e,void 0)).H=2,e.i=en(Ye(n)),n=!1,N.navigator&&N.navigator.sendBeacon&&(n=N.navigator.sendBeacon(e.i.toString(),"")),!n&&N.Image&&((new Image).src=e.i,n=!0),n||(e.a=cr(e.g,null),e.a.ba(e.i)),e.u=M(),Fe(e)}ar(t)}function Qn(t){t.a&&(er(t),t.a.cancel(),t.a=null)}function Hn(t){Qn(t),t.j&&(N.clearTimeout(t.j),t.j=null),rr(t),t.b.cancel(),t.h&&("number"==typeof t.h&&N.clearTimeout(t.h),t.h=null)}function Wn(t,e){t.g.push(new gn(t.Oa++,e)),3==t.v&&Yn(t)}function Yn(t){wn(t.b)||t.h||(t.h=!0,Xt(t.Ba,t),t.u=0)}function Xn(t,e){var n;n=e?e.f:t.R++;var r=Ye(t.B);tn(r,"SID",t.J),tn(r,"RID",n),tn(r,"AID",t.P),Jn(t,r),t.i&&t.l&&Bn(r,t.i,t.l),n=new Oe(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=$n(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),Tn(t.b,n),Re(n,r,e)}function Jn(t,e){t.f&&Ke({},(function(t,n){tn(e,n,t)}))}function $n(t,e,n){n=Math.min(t.g.length,n);var r=t.f?P(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].b)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),a=!1;else try{An(h,s,"req"+c+"_")}catch(zr){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function Zn(t){t.a||t.j||(t.T=1,Xt(t.Aa,t),t.o=0)}function tr(t){return!(t.a||t.j||3<=t.o||(t.T++,t.j=be(P(t.Aa,t),or(t,t.o)),t.o++,0))}function er(t){null!=t.s&&(N.clearTimeout(t.s),t.s=null)}function nr(t){t.a=new Oe(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Ye(t.la);tn(e,"RID","rpc"),tn(e,"SID",t.J),tn(e,"CI",t.H?"0":"1"),tn(e,"AID",t.P),Jn(t,e),tn(e,"TYPE","xmlhttp"),t.i&&t.l&&Bn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=en(Ye(e)),n.j=null,n.I=!0,Pe(n,t)}function rr(t){null!=t.m&&(N.clearTimeout(t.m),t.m=null)}function ir(t,e){var n=null;if(t.a==e){rr(t),er(t),t.a=null;var r=2}else{if(!En(t.b,e))return;n=e.s,_n(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=M()-e.u;var i=t.u;jt(r=de(),new me(r,n,e,i)),Yn(t)}else Zn(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(In(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.La?0:t.Ma)||(t.h=be(P(t.Ba,t,e),or(t,t.u)),t.u++,0)))}(t,e)||2==r&&tr(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:sr(t,5);break;case 4:sr(t,10);break;case 3:sr(t,6);break;default:sr(t,2)}}function or(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function sr(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=P(t.Ya,t);n||(n=new We("//www.google.com/images/cleardot.gif"),N.location&&"http"==N.location.protocol||Xe(n,"https"),en(n)),function(t,e){var n=new ce;if(N.Image){var r=new Image;r.onload=L(On,n,r,"TestLoadImage: loaded",!0,e),r.onerror=L(On,n,r,"TestLoadImage: error",!1,e),r.onabort=L(On,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=L(On,n,r,"TestLoadImage: timeout",!1,e),N.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else ge(2);t.v=0,t.f&&t.f.ra(e),ar(t),Hn(t)}function ar(t){t.v=0,t.I=-1,t.f&&(0==Sn(t.b).length&&0==t.g.length||(t.b.c.length=0,B(t.g),t.g.length=0),t.f.qa())}function ur(t,e,n){var r=function(t){return t instanceof We?Ye(t):new We(t,void 0)}(n);if(""!=r.c)e&&Je(r,e+"."+r.c),$e(r,r.h);else{var i=N.location;r=function(t,e,n,r){var i=new We(null,void 0);return t&&Xe(i,t),e&&Je(i,e),n&&$e(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&X(t.V,(function(t,e){tn(r,e,t)})),n=t.na,(e=t.A)&&n&&tn(r,e,n),tn(r,"VER",t.ha),Jn(t,r),r}function cr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Cn(t.Na)).F=t.C,e}function hr(){}function lr(){if(it&&!(10<=Number(yt)))throw Error("Environmental error: no available transport.")}function fr(t,e){Vt.call(this),this.a=new Gn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!K(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!K(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new yr(this)}function dr(t){Ne.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function pr(){De.call(this),this.status=1}function yr(t){this.a=t}(T=Cn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=function(t){var e;return(e=t.a)||(e=t.a={}),e}(this.H?this.H:_e),this.a.onreadystatechange=P(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(o){return void Mn(this,o)}t=n||"";var i=new Ge(this.headers);r&&Ke(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=Ln,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=N.FormData&&t instanceof N.FormData,!(0<=U(Pn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Vn(this),0<this.o&&((this.D=function(t){return it&&pt(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=P(this.xa,this)):this.m=ne(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(o){Mn(this,o)}},T.xa=function(){void 0!==S&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,jt(this,"timeout"),this.abort(8))},T.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,jt(this,"complete"),jt(this,"abort"),Un(this))},T.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Un(this,!0)),Cn.X.G.call(this)},T.za=function(){this.j||(this.A||this.l||this.g?qn(this):this.Ua())},T.Ua=function(){qn(this)},T.W=function(){try{return 2<jn(this)?this.a.status:-1}catch(nt){return-1}},T.$=function(){try{return this.a?this.a.responseText:""}catch(nt){return""}},T.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),kn(e)}},T.ua=function(){return this.h},T.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(T=Gn.prototype).ha=8,T.v=1,T.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Oe(this,this.c,t,void 0),r=this.l;if(this.O&&(r?Z(r=J(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=$n(this,n,e),tn(i=Ye(this.B),"RID",t),tn(i,"CVER",22),this.A&&tn(i,"X-HTTP-Session-Id",this.A),Jn(this,i),this.i&&r&&Bn(i,this.i,r),Tn(this.b,n),this.Ia&&tn(i,"TYPE","init"),this.da?(tn(i,"$req",e),tn(i,"SID","null"),n.U=!0,Re(n,i,null)):Re(n,i,e),this.v=2}}else 3==this.v&&(t?Xn(this,t):0==this.g.length||wn(this.b)||Xn(this))},T.Aa=function(){if(this.j=null,nr(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=be(P(this.Ta,this),t)}},T.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,ge(10),Qn(this),nr(this))},T.Sa=function(){null!=this.m&&(this.m=null,Qn(this),tr(this),ge(19))},T.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),ge(2)):(this.c.info("Failed to ping google.com"),ge(1))},(T=hr.prototype).ta=function(){},T.sa=function(){},T.ra=function(){},T.qa=function(){},T.Ja=function(){},lr.prototype.a=function(t,e){return new fr(t,e)},F(fr,Vt),fr.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;ge(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=ur(t,null,t.fa),Yn(t)},fr.prototype.close=function(){zn(this.a)},fr.prototype.h=function(t){if("string"==typeof t){var e={};e.__data__=t,Wn(this.a,e)}else this.l?((e={}).__data__=Kt(t),Wn(this.a,e)):Wn(this.a,t)},fr.prototype.G=function(){this.a.f=null,delete this.f,zn(this.a),delete this.a,fr.X.G.call(this)},F(dr,Ne),F(pr,De),F(yr,hr),yr.prototype.ta=function(){jt(this.a,"a")},yr.prototype.sa=function(t){jt(this.a,new dr(t))},yr.prototype.ra=function(t){jt(this.a,new pr(t))},yr.prototype.qa=function(){jt(this.a,"b")},lr.prototype.createWebChannel=lr.prototype.a,fr.prototype.send=fr.prototype.h,fr.prototype.open=fr.prototype.g,fr.prototype.close=fr.prototype.close,we.NO_ERROR=0,we.TIMEOUT=8,we.HTTP_ERROR=6,Ie.COMPLETE="complete",Te.EventType=Se,Se.OPEN="a",Se.CLOSE="b",Se.ERROR="c",Se.MESSAGE="d",Vt.prototype.listen=Vt.prototype.va,Cn.prototype.listenOnce=Cn.prototype.wa,Cn.prototype.getLastError=Cn.prototype.Qa,Cn.prototype.getLastErrorCode=Cn.prototype.ua,Cn.prototype.getStatus=Cn.prototype.W,Cn.prototype.getResponseJson=Cn.prototype.Pa,Cn.prototype.getResponseText=Cn.prototype.$,Cn.prototype.send=Cn.prototype.ba;var vr=we,gr=Ie,mr=le,br=Te,wr=Cn,Ir=function(t,e){return(Ir=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function Er(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}Ir(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function Tr(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(Od){o(Od)}}function a(t){try{u(r.throw(t))}catch(Od){o(Od)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))}function _r(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(Od){o=[6,Od],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function Sr(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t}var Nr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();Nr.o=-1;var Dr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Ar=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Er(e,t),e}(Error),Or=new w.b("@firebase/firestore");function kr(){return Or.logLevel}function Cr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Or.logLevel<=w.a.DEBUG){var r=e.map(Pr);Or.debug.apply(Or,Sr(["Firestore (8.3.2): "+t],r))}}function xr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Or.logLevel<=w.a.ERROR){var r=e.map(Pr);Or.error.apply(Or,Sr(["Firestore (8.3.2): "+t],r))}}function Rr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Or.logLevel<=w.a.WARN){var r=e.map(Pr);Or.warn.apply(Or,Sr(["Firestore (8.3.2): "+t],r))}}function Pr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(Od){return t}}function Lr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.3.2) INTERNAL ASSERTION FAILED: "+t;throw xr(e),new Error(e)}function Mr(t,e){t||Lr()}function Fr(t,e){return t}function qr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Ur=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=qr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Vr(t,e){return t<e?-1:t>e?1:0}function jr(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function Br(t){return t+"\0"}var Kr=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Ar(Dr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Ar(Dr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Ar(Dr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Ar(Dr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Vr(this.nanoseconds,t.nanoseconds):Vr(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Gr=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new Kr(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function zr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Qr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Hr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Wr=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Lr(),void 0===n?n=t.length-e:n>t.length-e&&Lr(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Yr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Er(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new Ar(Dr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new e(r)},e.emptyPath=function(){return new e([])},e}(Wr),Xr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Jr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Er(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return Xr.test(t)},e.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new Ar(Dr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new Ar(Dr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Ar(Dr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new Ar(Dr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(Wr),$r=function(){function t(t){this.fields=t,t.sort(Jr.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return jr(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),Zr=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Vr(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();Zr.EMPTY_BYTE_STRING=new Zr("");var ti=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ei(t){if(Mr(!!t),"string"==typeof t){var e=0,n=ti.exec(t);if(Mr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ni(t.seconds),nanos:ni(t.nanos)}}function ni(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ri(t){return"string"==typeof t?Zr.fromBase64String(t):Zr.fromUint8Array(t)}function ii(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function oi(t){var e=ei(t.mapValue.fields.__local_write_time__.timestampValue);return new Kr(e.seconds,e.nanos)}function si(t){return null==t}function ai(t){return 0===t&&1/t==-1/0}function ui(t){return"number"==typeof t&&Number.isInteger(t)&&!ai(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var ci=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Yr.fromString(e))},t.fromName=function(e){return new t(Yr.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Yr.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Yr.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Yr(e.slice()))},t}();function hi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ii(t)?4:10:Lr()}function li(t,e){var n=hi(t);if(n!==hi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return oi(t).isEqual(oi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=ei(t.timestampValue),r=ei(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return ri(t.bytesValue).isEqual(ri(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return ni(t.geoPointValue.latitude)===ni(e.geoPointValue.latitude)&&ni(t.geoPointValue.longitude)===ni(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ni(t.integerValue)===ni(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=ni(t.doubleValue),r=ni(e.doubleValue);return n===r?ai(n)===ai(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return jr(t.arrayValue.values||[],e.arrayValue.values||[],li);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(zr(n)!==zr(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!li(n[i],r[i])))return!1;return!0}(t,e);default:return Lr()}}function fi(t,e){return void 0!==(t.values||[]).find((function(t){return li(t,e)}))}function di(t,e){var n=hi(t),r=hi(e);if(n!==r)return Vr(n,r);switch(n){case 0:return 0;case 1:return Vr(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=ni(t.integerValue||t.doubleValue),r=ni(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return pi(t.timestampValue,e.timestampValue);case 4:return pi(oi(t),oi(e));case 5:return Vr(t.stringValue,e.stringValue);case 6:return function(t,e){var n=ri(t),r=ri(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Vr(n[i],r[i]);if(0!==o)return o}return Vr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Vr(ni(t.latitude),ni(e.latitude));return 0!==n?n:Vr(ni(t.longitude),ni(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=di(n[i],r[i]);if(o)return o}return Vr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Vr(r[s],o[s]);if(0!==a)return a;var u=di(n[r[s]],i[o[s]]);if(0!==u)return u}return Vr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Lr()}}function pi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Vr(t,e);var n=ei(t),r=ei(e),i=Vr(n.seconds,r.seconds);return 0!==i?i:Vr(n.nanos,r.nanos)}function yi(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){var e=ei(t);return"time("+e.seconds+","+e.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?ri(e.bytesValue).toBase64():"referenceValue"in e?ci.fromName(e.referenceValue).toString():"geoPointValue"in e?"geo("+(n=e.geoPointValue).latitude+","+n.longitude+")":"arrayValue"in e?function(e){for(var n="[",r=!0,i=0,o=e.values||[];i<o.length;i++)r?r=!1:n+=",",n+=t(o[i]);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var n="{",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=s+":"+t(e.fields[s])}return n+"}"}(e.mapValue):Lr();var n}(t)}function vi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function gi(t){return!!t&&"integerValue"in t}function mi(t){return!!t&&"arrayValue"in t}function bi(t){return!!t&&"nullValue"in t}function wi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ii(t){return!!t&&"mapValue"in t}var Ei=function(){function t(t){this.overlayMap=new Map,this.partialValue=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(e){return t.extractNestedValue(this.buildProto(),e)},t.prototype.toProto=function(){return this.field(Jr.emptyPath())},t.prototype.set=function(t,e){this.setOverlay(t,e)},t.prototype.setAll=function(t){var e=this;t.forEach((function(t,n){t?e.set(n,t):e.delete(n)}))},t.prototype.delete=function(t){this.setOverlay(t,null)},t.prototype.isEqual=function(t){return li(this.buildProto(),t.buildProto())},t.prototype.setOverlay=function(t,e){for(var n=this.overlayMap,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===hi(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.lastSegment(),e)},t.prototype.applyOverlay=function(e,n){var r=this,i=!1,o=t.extractNestedValue(this.partialValue,e),s=Ii(o)?Object.assign({},o.mapValue.fields):{};return n.forEach((function(t,n){if(t instanceof Map){var o=r.applyOverlay(e.child(n),t);null!=o&&(s[n]=o,i=!0)}else null!==t?(s[n]=t,i=!0):s.hasOwnProperty(n)&&(delete s[n],i=!0)})),i?{mapValue:{fields:s}}:null},t.prototype.buildProto=function(){var t=this.applyOverlay(Jr.emptyPath(),this.overlayMap);return null!=t&&(this.partialValue=t,this.overlayMap.clear()),this.partialValue},t.extractNestedValue=function(t,e){if(e.isEmpty())return t;for(var n=t,r=0;r<e.length-1;++r){if(!n.mapValue.fields)return null;if(!Ii(n=n.mapValue.fields[e.get(r)]))return null}return(n=(n.mapValue.fields||{})[e.lastSegment()])||null},t.prototype.clone=function(){return new t(this.buildProto())},t}();function Ti(t){var e=[];return Qr(t.fields||{},(function(t,n){var r=new Jr([t]);if(Ii(n)){var i=Ti(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)})),new $r(e)}var _i=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,Gr.min(),Ei.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,Ei.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,Ei.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Ei.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Ei.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.toProto())+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),Si=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Ni(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Si(t,e,n,r,i,o,s)}function Di(t){var e=Fr(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.canonicalString()+t.op.toString()+yi(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return function(t){return t.field.canonicalString()+t.dir}(t)})).join(","),si(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Vi(e.startAt)),e.endAt&&(n+="|ub:",n+=Vi(e.endAt)),e.h=n}return e.h}function Ai(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Bi(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!li(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Gi(t.startAt,e.startAt)&&Gi(t.endAt,e.endAt)}function Oi(t){return ci.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var ki=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Er(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new Ci(t,n,r):"array-contains"===n?new Li(t,r):"in"===n?new Mi(t,r):"not-in"===n?new Fi(t,r):"array-contains-any"===n?new qi(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new xi(t,n):new Ri(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(di(e,this.value)):null!==e&&hi(this.value)===hi(e)&&this.m(di(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Lr()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}((function(){})),Ci=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=ci.fromName(r.referenceValue),i}return Er(e,t),e.prototype.matches=function(t){var e=ci.comparator(t.key,this.key);return this.m(e)},e}(ki),xi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Pi(0,n),r}return Er(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(ki),Ri=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Pi(0,n),r}return Er(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(ki);function Pi(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return ci.fromName(t.referenceValue)}))}var Li=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Er(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return mi(e)&&fi(e.arrayValue,this.value)},e}(ki),Mi=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Er(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&fi(this.value.arrayValue,e)},e}(ki),Fi=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Er(e,t),e.prototype.matches=function(t){if(fi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!fi(this.value.arrayValue,e)},e}(ki),qi=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Er(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!mi(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return fi(e.value.arrayValue,t)}))},e}(ki),Ui=function(t,e){this.position=t,this.before=e};function Vi(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return yi(t)})).join(",")}var ji=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Bi(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Ki(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?ci.comparator(ci.fromName(s.referenceValue),n.key):di(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Gi(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!li(t.position[n],e.position[n]))return!1;return!0}var zi=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function Qi(t,e,n,r,i,o,s,a){return new zi(t,e,n,r,i,o,s,a)}function Hi(t){return new zi(t)}function Wi(t){return!si(t.limit)&&"F"===t.limitType}function Yi(t){return!si(t.limit)&&"L"===t.limitType}function Xi(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Ji(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function $i(t){return null!==t.collectionGroup}function Zi(t){var e=Fr(t);if(null===e.p){e.p=[];var n=Ji(e),r=Xi(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new ji(n)),e.p.push(new ji(Jr.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new ji(Jr.keyField(),u))}}}return e.p}function to(t){var e=Fr(t);if(!e.T)if("F"===e.limitType)e.T=Ni(e.path,e.collectionGroup,Zi(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Zi(e);r<i.length;r++){var o=i[r];n.push(new ji(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new Ui(e.endAt.position,!e.endAt.before):null,a=e.startAt?new Ui(e.startAt.position,!e.startAt.before):null;e.T=Ni(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function eo(t,e,n){return new zi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function no(t,e){return Ai(to(t),to(e))&&t.limitType===e.limitType}function ro(t){return Di(to(t))+"|lt:"+t.limitType}function io(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.canonicalString()+" "+e.op+" "+yi(e.value);var e})).join(", ")+"]"),si(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Vi(t.startAt)),t.endAt&&(e+=", endAt: "+Vi(t.endAt)),"Target("+e+")"}(to(t))+"; limitType="+t.limitType+")"}function oo(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):ci.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Ki(t.startAt,Zi(t),e)||t.endAt&&Ki(t.endAt,Zi(t),e))}(t,e)}function so(t){return function(e,n){for(var r=!1,i=0,o=Zi(t);i<o.length;i++){var s=o[i],a=ao(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function ao(t,e,n){var r=t.field.isKeyField()?ci.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?di(r,i):Lr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Lr()}}function uo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ai(e)?"-0":e}}function co(t){return{integerValue:""+t}}function ho(t,e){return ui(e)?co(e):uo(t,e)}var lo=function(){this._=void 0};function fo(t,e,n){return t instanceof vo?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof go?mo(t,e):t instanceof bo?wo(t,e):function(t,e){var n=yo(t,e),r=Eo(n)+Eo(t.A);return gi(n)&&gi(t.A)?co(r):uo(t.R,r)}(t,e)}function po(t,e,n){return t instanceof go?mo(t,e):t instanceof bo?wo(t,e):n}function yo(t,e){return t instanceof Io?gi(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var vo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Er(e,t),e}(lo),go=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Er(e,t),e}(lo);function mo(t,e){for(var n=To(e),r=function(t){n.some((function(e){return li(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var bo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Er(e,t),e}(lo);function wo(t,e){for(var n=To(e),r=function(t){n=n.filter((function(e){return!li(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Io=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Er(e,t),e}(lo);function Eo(t){return ni(t.integerValue||t.doubleValue)}function To(t){return mi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var _o=function(t,e){this.field=t,this.transform=e},So=function(t,e){this.version=t,this.transformResults=e},No=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Do(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var Ao=function(){};function Oo(t,e,n){t instanceof Po?function(t,e,n){var r=t.value.clone(),i=Fo(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Lo?function(t,e,n){if(Do(t.precondition,e)){var r=Fo(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Mo(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function ko(t,e,n){t instanceof Po?function(t,e,n){if(Do(t.precondition,e)){var r=t.value.clone(),i=qo(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(Ro(e),r).setHasLocalMutations()}}(t,e,n):t instanceof Lo?function(t,e,n){if(Do(t.precondition,e)){var r=qo(t.fieldTransforms,n,e),i=e.data;i.setAll(Mo(t)),i.setAll(r),e.convertToFoundDocument(Ro(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){Do(t.precondition,e)&&e.convertToNoDocument(Gr.min())}(t,e)}function Co(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=yo(o.transform,s||null);null!=a&&(null==n&&(n=Ei.empty()),n.set(o.field,a))}return n||null}function xo(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&jr(t,e,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof go&&e instanceof go||t instanceof bo&&e instanceof bo?jr(t.elements,e.elements,li):t instanceof Io&&e instanceof Io?li(t.A,e.A):t instanceof vo&&e instanceof vo}(t.transform,e.transform)}(t,e)}))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Ro(t){return t.isFoundDocument()?t.version:Gr.min()}var Po=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Er(e,t),e}(Ao),Lo=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Er(e,t),e}(Ao);function Mo(t){var e=new Map;return t.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}})),e}function Fo(t,e,n){var r=new Map;Mr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,po(s,a,n[i]))}return r}function qo(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,fo(a,u,e))}return r}var Uo,Vo,jo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Er(e,t),e}(Ao),Bo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Er(e,t),e}(Ao),Ko=function(t){this.count=t};function Go(t){switch(t){case Dr.OK:return Lr();case Dr.CANCELLED:case Dr.UNKNOWN:case Dr.DEADLINE_EXCEEDED:case Dr.RESOURCE_EXHAUSTED:case Dr.INTERNAL:case Dr.UNAVAILABLE:case Dr.UNAUTHENTICATED:return!1;case Dr.INVALID_ARGUMENT:case Dr.NOT_FOUND:case Dr.ALREADY_EXISTS:case Dr.PERMISSION_DENIED:case Dr.FAILED_PRECONDITION:case Dr.ABORTED:case Dr.OUT_OF_RANGE:case Dr.UNIMPLEMENTED:case Dr.DATA_LOSS:return!0;default:return Lr()}}function zo(t){if(void 0===t)return xr("GRPC error has no .code"),Dr.UNKNOWN;switch(t){case Uo.OK:return Dr.OK;case Uo.CANCELLED:return Dr.CANCELLED;case Uo.UNKNOWN:return Dr.UNKNOWN;case Uo.DEADLINE_EXCEEDED:return Dr.DEADLINE_EXCEEDED;case Uo.RESOURCE_EXHAUSTED:return Dr.RESOURCE_EXHAUSTED;case Uo.INTERNAL:return Dr.INTERNAL;case Uo.UNAVAILABLE:return Dr.UNAVAILABLE;case Uo.UNAUTHENTICATED:return Dr.UNAUTHENTICATED;case Uo.INVALID_ARGUMENT:return Dr.INVALID_ARGUMENT;case Uo.NOT_FOUND:return Dr.NOT_FOUND;case Uo.ALREADY_EXISTS:return Dr.ALREADY_EXISTS;case Uo.PERMISSION_DENIED:return Dr.PERMISSION_DENIED;case Uo.FAILED_PRECONDITION:return Dr.FAILED_PRECONDITION;case Uo.ABORTED:return Dr.ABORTED;case Uo.OUT_OF_RANGE:return Dr.OUT_OF_RANGE;case Uo.UNIMPLEMENTED:return Dr.UNIMPLEMENTED;case Uo.DATA_LOSS:return Dr.DATA_LOSS;default:return Lr()}}(Vo=Uo||(Uo={}))[Vo.OK=0]="OK",Vo[Vo.CANCELLED=1]="CANCELLED",Vo[Vo.UNKNOWN=2]="UNKNOWN",Vo[Vo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Vo[Vo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Vo[Vo.NOT_FOUND=5]="NOT_FOUND",Vo[Vo.ALREADY_EXISTS=6]="ALREADY_EXISTS",Vo[Vo.PERMISSION_DENIED=7]="PERMISSION_DENIED",Vo[Vo.UNAUTHENTICATED=16]="UNAUTHENTICATED",Vo[Vo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Vo[Vo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Vo[Vo.ABORTED=10]="ABORTED",Vo[Vo.OUT_OF_RANGE=11]="OUT_OF_RANGE",Vo[Vo.UNIMPLEMENTED=12]="UNIMPLEMENTED",Vo[Vo.INTERNAL=13]="INTERNAL",Vo[Vo.UNAVAILABLE=14]="UNAVAILABLE",Vo[Vo.DATA_LOSS=15]="DATA_LOSS";var Qo=function(){function t(t,e){this.comparator=t,this.root=e||Wo.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Wo.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Wo.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Ho(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Ho(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Ho(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Ho(this.root,t,this.comparator,!0)},t}(),Ho=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Wo=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Lr();if(this.right.isRed())throw Lr();var t=this.left.check();if(t!==this.right.check())throw Lr();return t+(this.isRed()?0:1)},t}();Wo.EMPTY=null,Wo.RED=!0,Wo.BLACK=!1,Wo.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Lr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Lr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Lr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Lr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Lr()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Wo(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var Yo=function(){function t(t){this.comparator=t,this.data=new Qo(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Xo(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Xo(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Xo=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Jo=new Qo(ci.comparator);function $o(){return Jo}var Zo=new Qo(ci.comparator);function ts(){return Zo}var es=new Qo(ci.comparator);function ns(){return es}var rs=new Yo(ci.comparator);function is(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=rs,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var os=new Yo(Vr);function ss(){return os}var as=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,us.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(Gr.min(),r,ss(),$o(),is())},t}(),us=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(Zr.EMPTY_BYTE_STRING,n,is(),is(),is())},t}(),cs=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},hs=function(t,e){this.targetId=t,this.V=e},ls=function(t,e,n,r){void 0===n&&(n=Zr.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},fs=function(){function t(){this.S=0,this.D=ys(),this.C=Zr.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"O",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.$=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=is(),e=is(),n=is();return this.D.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Lr()}})),new us(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=ys()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),ds=function(){function t(t){this.W=t,this.G=new Map,this.H=$o(),this.J=ps(),this.Y=new Yo(Vr)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.$(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.$(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.$(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.$(t.resumeToken));break;default:Lr()}}))},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach((function(t,r){n.st(r)&&e(r)}))},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(Oi(i))if(0===n){var o=new ci(i.path);this.tt(e,o,_i.newNoDocument(o,Gr.min()))}else Mr(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach((function(r,i){var o=e.ot(i);if(o){if(r.current&&Oi(o.target)){var s=new ci(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,_i.newNoDocument(s,t))}r.O&&(n.set(i,r.M()),r.L())}}));var r=is();this.J.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new as(t,n,this.Y,this.H,r);return this.H=$o(),this.J=ps(),this.Y=new Yo(Vr),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new fs,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Yo(Vr),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||Cr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new fs),this.W.getRemoteKeysForTarget(t).forEach((function(n){e.tt(t,n,null)}))},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function ps(){return new Qo(ci.comparator)}function ys(){return new Qo(ci.comparator)}var vs={asc:"ASCENDING",desc:"DESCENDING"},gs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ms=function(t,e){this.databaseId=t,this.I=e};function bs(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ws(t,e){return t.I?e.toBase64():e.toUint8Array()}function Is(t,e){return bs(t,e.toTimestamp())}function Es(t){return Mr(!!t),Gr.fromTimestamp(function(t){var e=ei(t);return new Kr(e.seconds,e.nanos)}(t))}function Ts(t,e){return function(t){return new Yr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function _s(t){var e=Yr.fromString(t);return Mr(Hs(e)),e}function Ss(t,e){return Ts(t.databaseId,e.path)}function Ns(t,e){var n=_s(e);if(n.get(1)!==t.databaseId.projectId)throw new Ar(Dr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Ar(Dr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ci(ks(n))}function Ds(t,e){return Ts(t.databaseId,e)}function As(t){var e=_s(t);return 4===e.length?Yr.emptyPath():ks(e)}function Os(t){return new Yr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ks(t){return Mr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Cs(t,e,n){return{name:Ss(t,e),fields:n.toProto().mapValue.fields}}function xs(t,e,n){var r=Ns(t,e.name),i=Es(e.updateTime),o=new Ei({mapValue:{fields:e.fields}}),s=_i.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function Rs(t,e){var n;if(e instanceof Po)n={update:Cs(t,e.key,e.value)};else if(e instanceof jo)n={delete:Ss(t,e.key)};else if(e instanceof Lo)n={update:Cs(t,e.key,e.data),updateMask:Qs(e.fieldMask)};else{if(!(e instanceof Bo))return Lr();n={verify:Ss(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof vo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof go)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof bo)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Io)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Lr()}(0,t)}))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Is(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Lr()}(t,e.precondition)),n}function Ps(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?No.updateTime(Es(t.updateTime)):void 0!==t.exists?No.exists(t.exists):No.none()}(e.currentDocument):No.none(),r=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;"setToServerValue"in e?(Mr("REQUEST_TIME"===e.setToServerValue),n=new vo):"appendMissingElements"in e?n=new go(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new bo(e.removeAllFromArray.values||[]):"increment"in e?n=new Io(t,e.increment):Lr();var r=Jr.fromServerFormat(e.fieldPath);return new _o(r,n)}(t,e)})):[];if(e.update){var i=Ns(t,e.update.name),o=new Ei({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new $r((t.fieldPaths||[]).map((function(t){return Jr.fromServerFormat(t)})))}(e.updateMask);return new Lo(i,o,s,n,r)}return new Po(i,o,n,r)}if(e.delete){var a=Ns(t,e.delete);return new jo(a,n)}if(e.verify){var u=Ns(t,e.verify);return new Bo(u,n)}return Lr()}function Ls(t,e){return{documents:[Ds(t,e.path)]}}function Ms(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Ds(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Ds(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(wi(t.value))return{unaryFilter:{field:Bs(t.field),op:"IS_NAN"}};if(bi(t.value))return{unaryFilter:{field:Bs(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(wi(t.value))return{unaryFilter:{field:Bs(t.field),op:"IS_NOT_NAN"}};if(bi(t.value))return{unaryFilter:{field:Bs(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Bs(t.field),op:js(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:Bs(t.field),direction:Vs(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||si(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=qs(e.startAt)),e.endAt&&(n.structuredQuery.endAt=qs(e.endAt)),n}function Fs(t){var e=As(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Mr(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[zs(e)]:void 0!==e.fieldFilter?[Gs(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):Lr():[]}(n.where));var a=[];n.orderBy&&(a=n.orderBy.map((function(t){return function(t){return new ji(Ks(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var u=null;n.limit&&(u=function(t){var e;return si(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Us(n.startAt));var h=null;return n.endAt&&(h=Us(n.endAt)),Qi(e,i,a,s,u,"F",c,h)}function qs(t){return{before:t.before,values:t.position}}function Us(t){return new Ui(t.values||[],!!t.before)}function Vs(t){return vs[t]}function js(t){return gs[t]}function Bs(t){return{fieldPath:t.canonicalString()}}function Ks(t){return Jr.fromServerFormat(t.fieldPath)}function Gs(t){return ki.create(Ks(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Lr()}}(t.fieldFilter.op),t.fieldFilter.value)}function zs(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Ks(t.unaryFilter.field);return ki.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Ks(t.unaryFilter.field);return ki.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Ks(t.unaryFilter.field);return ki.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Ks(t.unaryFilter.field);return ki.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Lr()}}function Qs(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}}function Hs(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function Ws(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Xs(e)),e=Ys(t.get(n),e);return Xs(e)}function Ys(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function Xs(t){return t+"\x01\x01"}function Js(t){var e=t.length;if(Mr(e>=2),2===e)return Mr("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),Yr.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&Lr(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:Lr()}o=s+2}return new Yr(r)}var $s=function(t,e){this.seconds=t,this.nanoseconds=e},Zs=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Zs.store="owner",Zs.key="owner";var ta=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};ta.store="mutationQueues",ta.keyPath="userId";var ea=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};ea.store="mutations",ea.keyPath="batchId",ea.userMutationsIndex="userMutationsIndex",ea.userMutationsKeyPath=["userId","batchId"];var na=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Ws(e)]},t.key=function(t,e,n){return[t,Ws(e),n]},t}();na.store="documentMutations",na.PLACEHOLDER=new na;var ra=function(t,e){this.path=t,this.readTime=e},ia=function(t,e){this.path=t,this.version=e},oa=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};oa.store="remoteDocuments",oa.readTimeIndex="readTimeIndex",oa.readTimeIndexPath="readTime",oa.collectionReadTimeIndex="collectionReadTimeIndex",oa.collectionReadTimeIndexPath=["parentPath","readTime"];var sa=function(t){this.byteSize=t};sa.store="remoteDocumentGlobal",sa.key="remoteDocumentGlobalKey";var aa=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};aa.store="targets",aa.keyPath="targetId",aa.queryTargetsIndexName="queryTargetsIndex",aa.queryTargetsKeyPath=["canonicalId","targetId"];var ua=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};ua.store="targetDocuments",ua.keyPath=["targetId","path"],ua.documentTargetsIndex="documentTargetsIndex",ua.documentTargetsKeyPath=["path","targetId"];var ca=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};ca.key="targetGlobalKey",ca.store="targetGlobal";var ha=function(t,e){this.collectionId=t,this.parent=e};ha.store="collectionParents",ha.keyPath=["collectionId","parent"];var la=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};la.store="clientMetadata",la.keyPath="clientId";var fa=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};fa.store="bundles",fa.keyPath="bundleId";var da=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};da.store="namedQueries",da.keyPath="name";var pa=Sr(Sr([],Sr(Sr([],Sr(Sr([],Sr(Sr([],[ta.store,ea.store,na.store,oa.store,aa.store,Zs.store,ca.store,ua.store]),[la.store])),[sa.store])),[ha.store])),[fa.store,da.store]),ya="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",va=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},t}(),ga=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},ma=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Lr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}}))},t.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.waitFor=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},t}(),ba=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new ga,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new Ea(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=Da(e.target.error);n.ft.reject(new Ea(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new Ea(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(Cr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new _a(e)},t}(),wa=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(Object(b.h)())&&xr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return Cr("SimpleDb","Removing database:",t),Sa(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=Object(b.h)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return Tr(this,void 0,void 0,(function(){var e,n=this;return _r(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(Cr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new Ea(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new Ar(Dr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new Ea(t,n))},i.onupgradeneeded=function(t){Cr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next((function(){Cr("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}}))}))},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Tr(this,void 0,void 0,(function(){var i,o,s,a,u;return _r(this,(function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return _r(this,(function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=ba.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch((function(t){return e.abort(t),ma.reject(t)})).toPromise(),u={},s.catch((function(){})),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return Cr("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}}))},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),Ia=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return Sa(this.Pt.delete())},t}(),Ea=function(t){function e(e,n){var r=this;return(r=t.call(this,Dr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Er(e,t),e}(Ar);function Ta(t){return"IndexedDbTransactionError"===t.name}var _a=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Cr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Cr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Sa(n)},t.prototype.add=function(t){return Cr("SimpleDb","ADD",this.store.name,t,t),Sa(this.store.add(t))},t.prototype.get=function(t){var e=this;return Sa(this.store.get(t)).next((function(n){return void 0===n&&(n=null),Cr("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return Cr("SimpleDb","DELETE",this.store.name,t),Sa(this.store.delete(t))},t.prototype.count=function(){return Cr("SimpleDb","COUNT",this.store.name),Sa(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.Ft=function(t,e){Cr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,(function(t,e,n){return n.delete()}))},t.prototype.Ot=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.$t=function(t){var e=this.cursor({});return new ma((function(n,r){e.onerror=function(t){var e=Da(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.xt=function(t,e){var n=[];return new ma((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Ia(i),s=e(i.primaryKey,i.value,o);if(s instanceof ma){var a=s.catch((function(t){return o.done(),ma.reject(t)}));n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}})).next((function(){return ma.waitFor(n)}))},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Sa(t){return new ma((function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=Da(t.target.error);n(e)}}))}var Na=!1;function Da(t){var e=wa._t(Object(b.h)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new Ar("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Na||(Na=!0,setTimeout((function(){throw r}),0)),r}}return t}var Aa=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Er(e,t),e}(va);function Oa(t,e){var n=Fr(t);return wa.It(n.Mt,e)}var ka=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&Oo(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&ko(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&ko(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach((function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(Gr.min())}))},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),is())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&jr(this.mutations,t.mutations,(function(t,e){return xo(t,e)}))&&jr(this.baseMutations,t.baseMutations,(function(t,e){return xo(t,e)}))},t}(),Ca=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){Mr(e.mutations.length===r.length);for(var i=ns(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),xa=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Gr.min()),void 0===o&&(o=Gr.min()),void 0===s&&(s=Zr.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Ra=function(t){this.Lt=t};function Pa(t,e){if(e.document)return xs(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=ci.fromSegments(e.noDocument.path),r=Ua(e.noDocument.readTime),i=_i.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=ci.fromSegments(e.unknownDocument.path);return r=Ua(e.unknownDocument.version),_i.newUnknownDocument(o,r)}return Lr()}function La(t,e,n){var r=Ma(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:Ss(t,e.key),fields:e.data.toProto().mapValue.fields,updateTime:bs(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new oa(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=qa(e.version);return s=e.hasCommittedMutations,new oa(null,new ra(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=qa(e.version);return new oa(new ia(c,h),null,null,!0,r,i)}return Lr()}function Ma(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Fa(t){var e=new Kr(t[0],t[1]);return Gr.fromTimestamp(e)}function qa(t){var e=t.toTimestamp();return new $s(e.seconds,e.nanoseconds)}function Ua(t){var e=new Kr(t.seconds,t.nanoseconds);return Gr.fromTimestamp(e)}function Va(t,e){for(var n=(e.baseMutations||[]).map((function(e){return Ps(t.Lt,e)})),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map((function(e){return Ps(t.Lt,e)})),o=Kr.fromMillis(e.localWriteTimeMs);return new ka(e.batchId,o,n,i)}function ja(t){var e,n,r=Ua(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Ua(t.lastLimboFreeSnapshotVersion):Gr.min();return void 0!==t.query.documents?(Mr(1===(n=t.query).documents.length),e=to(Hi(As(n.documents[0])))):e=function(t){return to(Fs(t))}(t.query),new xa(e,t.targetId,0,t.lastListenSequenceNumber,r,i,Zr.fromBase64String(t.resumeToken))}function Ba(t,e){var n,r=qa(e.snapshotVersion),i=qa(e.lastLimboFreeSnapshotVersion);n=Oi(e.target)?Ls(t.Lt,e.target):Ms(t.Lt,e.target);var o=e.resumeToken.toBase64();return new aa(e.targetId,Di(e.target),r,o,e.sequenceNumber,i,n)}function Ka(t){var e=Fs({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?eo(e,e.limit,"L"):e}var Ga=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return za(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:Ua(e.createTime),version:e.version};var e}))},t.prototype.saveBundleMetadata=function(t,e){return za(t).put({bundleId:(n=e).id,createTime:qa(Es(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return Qa(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:Ka(e.bundledQuery),readTime:Ua(e.readTime)};var e}))},t.prototype.saveNamedQuery=function(t,e){return Qa(t).put(function(t){return{name:t.name,readTime:qa(Es(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function za(t){return Oa(t,fa.store)}function Qa(t){return Oa(t,da.store)}var Ha=function(){function t(){this.Bt=new Wa}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),ma.resolve()},t.prototype.getCollectionParents=function(t,e){return ma.resolve(this.Bt.getEntries(e))},t}(),Wa=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Yo(Yr.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Yo(Yr.comparator)).toArray()},t}(),Ya=function(){function t(){this.qt=new Wa}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.qt.add(e)}));var o={collectionId:r,parent:Ws(i)};return Xa(t).put(o)}return ma.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Br(e),""],!1,!0);return Xa(t).Nt(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Js(o.parent))}return n}))},t}();function Xa(t){return Oa(t,ha.store)}var Ja={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},$a=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function Za(t,e,n){var r=t.store(ea.store),i=t.store(na.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.Ot({range:s},(function(t,e,n){return a++,n.delete()}));o.push(u.next((function(){Mr(1===a)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=na.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return ma.waitFor(o).next((function(){return c}))}function tu(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Lr();e=t.noDocument}return JSON.stringify(e).length}$a.DEFAULT_COLLECTION_PERCENTILE=10,$a.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,$a.DEFAULT=new $a(41943040,$a.DEFAULT_COLLECTION_PERCENTILE,$a.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),$a.DISABLED=new $a(-1,0,0);var eu=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Qt={}}return t.Kt=function(e,n,r,i){return Mr(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ru(t).Ot({index:ea.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=iu(t),s=ru(t);return s.add({}).next((function(a){Mr("number"==typeof a);for(var u=new ka(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return Rs(t.Lt,e)})),i=n.mutations.map((function(e){return Rs(t.Lt,e)}));return new ea(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new Yo((function(t,e){return Vr(t.canonicalString(),e.canonicalString())})),f=0,d=r;f<d.length;f++){var p=d[f],y=na.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,na.PLACEHOLDER))}return l.forEach((function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.Qt[a]=u.keys()})),ma.waitFor(h).next((function(){return u}))}))},t.prototype.lookupMutationBatch=function(t,e){var n=this;return ru(t).get(e).next((function(t){return t?(Mr(t.userId===n.userId),Va(n.R,t)):null}))},t.prototype.jt=function(t,e){var n=this;return this.Qt[e]?ma.resolve(this.Qt[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.Qt[e]=r,r}return null}))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return ru(t).Ot({index:ea.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(Mr(e.batchId>=r),o=Va(n.R,e)),i.done()})).next((function(){return o}))},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return ru(t).Ot({index:ea.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ru(t).Nt(ea.userMutationsIndex,n).next((function(t){return t.map((function(t){return Va(e.R,t)}))}))},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=na.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return iu(t).Ot({range:i},(function(r,i,s){var a=r[0],u=r[2],c=Js(r[1]);if(a===n.userId&&e.path.isEqual(c))return ru(t).get(u).next((function(t){if(!t)throw Lr();Mr(t.userId===n.userId),o.push(Va(n.R,t))}));s.done()})).next((function(){return o}))},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Yo(Vr),i=[];return e.forEach((function(e){var o=na.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=iu(t).Ot({range:s},(function(t,i,o){var s=t[0],a=t[2],u=Js(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()}));i.push(a)})),ma.waitFor(i).next((function(){return n.Wt(t,r)}))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=na.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Yo(Vr);return iu(t).Ot({range:s},(function(t,e,o){var s=t[0],u=t[2],c=Js(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()})).next((function(){return n.Wt(t,a)}))},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(ru(t).get(e).next((function(t){if(null===t)throw Lr();Mr(t.userId===n.userId),r.push(Va(n.R,t))})))})),ma.waitFor(i).next((function(){return r}))},t.prototype.removeMutationBatch=function(t,e){var n=this;return Za(t.Mt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Gt(e.batchId)})),ma.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},t.prototype.Gt=function(t){delete this.Qt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return ma.resolve();var r=IDBKeyRange.lowerBound(na.prefixForUser(e.userId)),i=[];return iu(t).Ot({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Js(t[1]);i.push(o)}else r.done()})).next((function(){Mr(0===i.length)}))}))},t.prototype.containsKey=function(t,e){return nu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return ou(t).get(this.userId).next((function(t){return t||new ta(e.userId,-1,"")}))},t}();function nu(t,e,n){var r=na.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return iu(t).Ot({range:o,kt:!0},(function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()})).next((function(){return s}))}function ru(t){return Oa(t,ea.store)}function iu(t){return Oa(t,na.store)}function ou(t){return Oa(t,ta.store)}var su=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),au=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next((function(n){var r=new su(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next((function(t){return Gr.fromTimestamp(new Kr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)}))},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next((function(){return n.Xt(t).next((function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)}))}))},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return uu(t).delete(e.targetId)})).next((function(){return n.Xt(t)})).next((function(e){return Mr(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)}))},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return uu(t).Ot((function(s,a){var u=ja(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))})).next((function(){return ma.waitFor(o)})).next((function(){return i}))},t.prototype.forEachTarget=function(t,e){return uu(t).Ot((function(t,n){var r=ja(n);e(r)}))},t.prototype.Xt=function(t){return cu(t).get(ca.key).next((function(t){return Mr(null!==t),t}))},t.prototype.Zt=function(t,e){return cu(t).put(ca.key,e)},t.prototype.te=function(t,e){return uu(t).put(Ba(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next((function(t){return t.targetCount}))},t.prototype.getTargetData=function(t,e){var n=Di(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return uu(t).Ot({range:r,index:aa.queryTargetsIndexName},(function(t,n,r){var o=ja(n);Ai(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=hu(t);return e.forEach((function(e){var s=Ws(e.path);i.push(o.put(new ua(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))})),ma.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=hu(t);return ma.forEach(e,(function(e){var o=Ws(e.path);return ma.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])}))},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=hu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=hu(t),i=is();return r.Ot({range:n,kt:!0},(function(t,e,n){var r=Js(t[1]),o=new ci(r);i=i.add(o)})).next((function(){return i}))},t.prototype.containsKey=function(t,e){var n=Ws(e.path),r=IDBKeyRange.bound([n],[Br(n)],!1,!0),i=0;return hu(t).Ot({index:ua.documentTargetsIndex,kt:!0,range:r},(function(t,e,n){0!==t[0]&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.lt=function(t,e){return uu(t).get(e).next((function(t){return t?ja(t):null}))},t}();function uu(t){return Oa(t,aa.store)}function cu(t){return Oa(t,ca.store)}function hu(t){return Oa(t,ua.store)}function lu(t){return Tr(this,void 0,void 0,(function(){return _r(this,(function(e){if(t.code!==Dr.FAILED_PRECONDITION||t.message!==ya)throw t;return Cr("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}function fu(t,e){var n=t[1],r=e[1],i=Vr(t[0],e[0]);return 0===i?Vr(n,r):i}var du=function(){function t(t){this.ne=t,this.buffer=new Yo(fu),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();fu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),pu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;Cr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(function(){return Tr(e,void 0,void 0,(function(){var e;return _r(this,(function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return Ta(e=n.sent())?(Cr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,lu(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),yu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return ma.resolve(Nr.o);var r=new du(e);return this.ae.forEachTarget(t,(function(t){return r.re(t.sequenceNumber)})).next((function(){return n.ae.le(t,(function(t){return r.re(t)}))})).next((function(){return r.maxValue}))},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Cr("LruGarbageCollector","Garbage collection skipped; disabled"),ma.resolve(Ja)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(Cr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Ja):n.fe(t,e)}))},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return e>c.params.maximumSequenceNumbersToCollect?(Cr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)})).next((function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)})).next((function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)})).next((function(t){return u=Date.now(),kr()<=w.a.DEBUG&&Cr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),ma.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))},t}(),vu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new yu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.de=function(t){var e=0;return this.le(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,(function(t,n){return e(n)}))},t.prototype.addReference=function(t,e,n){return gu(t,n)},t.prototype.removeReference=function(t,e,n){return gu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return gu(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return ou(t).$t((function(r){return nu(t,r,e).next((function(t){return t&&(n=!0),ma.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,(function(s,a){if(a<=e){var u=n._e(t,s).next((function(e){if(!e)return o++,r.getEntry(t,s).next((function(){return r.removeEntry(s),hu(t).delete([0,Ws(s.path)])}))}));i.push(u)}})).next((function(){return ma.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return gu(t,e)},t.prototype.we=function(t,e){var n,r=hu(t),i=Nr.o;return r.Ot({index:ua.documentTargetsIndex},(function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==Nr.o&&e(new ci(Js(n)),i),i=s,n=o):i=Nr.o})).next((function(){i!==Nr.o&&e(new ci(Js(n)),i)}))},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function gu(t,e){return hu(t).put(function(t,e){return new ua(0,Ws(t.path),e)}(e,t.currentSequenceNumber))}var mu=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Qr(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}}))},t.prototype.isEmpty=function(){return Hr(this.inner)},t}(),bu=function(){function t(){this.changes=new mu((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:Gr.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:_i.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?ma.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),wu=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return Tu(t).put(_u(e),n)},t.prototype.removeEntry=function(t,e){var n=Tu(t),r=_u(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.me(t,r)}))},t.prototype.getEntry=function(t,e){var n=this;return Tu(t).get(_u(e)).next((function(t){return n.ye(e,t)}))},t.prototype.ge=function(t,e){var n=this;return Tu(t).get(_u(e)).next((function(t){return{document:n.ye(e,t),size:tu(t)}}))},t.prototype.getEntries=function(t,e){var n=this,r=$o();return this.pe(t,e,(function(t,e){var i=n.ye(t,e);r=r.insert(t,i)})).next((function(){return r}))},t.prototype.Ee=function(t,e){var n=this,r=$o(),i=new Qo(ci.comparator);return this.pe(t,e,(function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,tu(e))})).next((function(){return{documents:r,Te:i}}))},t.prototype.pe=function(t,e,n){if(e.isEmpty())return ma.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Tu(t).Ot({range:r},(function(t,e,r){for(var s=ci.fromSegments(t);o&&ci.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=$o(),o=e.path.length+1,s={};if(n.isEqual(Gr.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=Ma(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=oa.collectionReadTimeIndex}return Tu(t).Ot(s,(function(t,n,s){if(t.length===o){var a=Pa(r.R,n);e.path.isPrefixOf(a.key.path)?oo(e,a)&&(i=i.insert(a.key,a)):s.done()}})).next((function(){return i}))},t.prototype.newChangeBuffer=function(t){return new Iu(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return Eu(t).get(sa.key).next((function(t){return Mr(!!t),t}))},t.prototype.me=function(t,e){return Eu(t).put(sa.key,e)},t.prototype.ye=function(t,e){if(e){var n=Pa(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(Gr.min()))return n}return _i.newInvalidDocument(t)},t}(),Iu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new mu((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return Er(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Yo((function(t,e){return Vr(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=La(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=tu(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=La(e.Ie.R,_i.newNoDocument(o,Gr.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))})),i.forEach((function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))})),n.push(this.Ie.updateMetadata(t,r)),ma.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next((function(t){return n.Ae.set(e,t.size),t.document}))},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next((function(t){var e=t.documents;return t.Te.forEach((function(t,e){n.Ae.set(t,e)})),e}))},e}(bu);function Eu(t){return Oa(t,sa.store)}function Tu(t){return Oa(t,oa.store)}function _u(t){return t.path.toArray()}var Su=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;Mr(n<r&&n>=0&&r<=11);var o=new ba("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Zs.store)}(t),function(t){t.createObjectStore(ta.store,{keyPath:ta.keyPath}),t.createObjectStore(ea.store,{keyPath:ea.keyPath,autoIncrement:!0}).createIndex(ea.userMutationsIndex,ea.userMutationsKeyPath,{unique:!0}),t.createObjectStore(na.store)}(t),Nu(t),function(t){t.createObjectStore(oa.store)}(t));var s=ma.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(ua.store),t.deleteObjectStore(aa.store),t.deleteObjectStore(ca.store)}(t),Nu(t)),s=s.next((function(){return function(t){var e=t.store(ca.store),n=new ca(0,0,Gr.min().toTimestamp(),0);return e.put(ca.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(ea.store).Nt().next((function(n){t.deleteObjectStore(ea.store),t.createObjectStore(ea.store,{keyPath:ea.keyPath,autoIncrement:!0}).createIndex(ea.userMutationsIndex,ea.userMutationsKeyPath,{unique:!0});var r=e.store(ea.store),i=n.map((function(t){return r.put(t)}));return ma.waitFor(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(la.store,{keyPath:la.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.Re(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(sa.store)}(t),i.be(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ve(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.Pe(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(oa.store);e.createIndex(oa.readTimeIndex,oa.readTimeIndexPath,{unique:!1}),e.createIndex(oa.collectionReadTimeIndex,oa.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.Ve(o)}))),n<11&&r>=11&&(s=s.next((function(){!function(t){t.createObjectStore(fa.store,{keyPath:fa.keyPath})}(t),function(t){t.createObjectStore(da.store,{keyPath:da.keyPath})}(t)}))),s},t.prototype.be=function(t){var e=0;return t.store(oa.store).Ot((function(t,n){e+=tu(n)})).next((function(){var n=new sa(e);return t.store(sa.store).put(sa.key,n)}))},t.prototype.Re=function(t){var e=this,n=t.store(ta.store),r=t.store(ea.store);return n.Nt().next((function(n){return ma.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(ea.userMutationsIndex,i).next((function(r){return ma.forEach(r,(function(r){Mr(r.userId===n.userId);var i=Va(e.R,r);return Za(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ve=function(t){var e=t.store(ua.store),n=t.store(oa.store);return t.store(ca.store).get(ca.key).next((function(t){var r=[];return n.Ot((function(n,i){var o=new Yr(n),s=function(t){return[0,Ws(t)]}(o);r.push(e.get(s).next((function(n){return n?ma.resolve():function(n){return e.put(new ua(0,Ws(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return ma.waitFor(r)}))}))},t.prototype.Pe=function(t,e){t.createObjectStore(ha.store,{keyPath:ha.keyPath});var n=e.store(ha.store),r=new Wa,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Ws(i)})}};return e.store(oa.store).Ot({kt:!0},(function(t,e){var n=new Yr(t);return i(n.popLast())})).next((function(){return e.store(na.store).Ot({kt:!0},(function(t,e){var n=Js(t[1]);return i(n.popLast())}))}))},t.prototype.Ve=function(t){var e=this,n=t.store(aa.store);return n.Ot((function(t,r){var i=ja(r),o=Ba(e.R,i);return n.put(o)}))},t}();function Nu(t){t.createObjectStore(ua.store,{keyPath:ua.keyPath}).createIndex(ua.documentTargetsIndex,ua.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(aa.store,{keyPath:aa.keyPath}).createIndex(aa.queryTargetsIndexName,aa.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ca.store)}var Du="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Au=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.Oe=null,this.$e=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new Ar(Dr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new vu(this,i),this.Le=n+"main",this.R=new Ra(u),this.Be=new wa(this.Le,11,new Su(this.R)),this.qe=new au(this.referenceDelegate,this.R),this.Ut=new Ya,this.Ue=function(t,e){return new wu(t,e)}(this.R,this.Ut),this.Qe=new Ga,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,!1===h&&xr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Ar(Dr.FAILED_PRECONDITION,Du);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.qe.getHighestSequenceNumber(e)}))})).then((function(e){t.Ne=new Nr(e,t.De)})).then((function(){t.xe=!0})).catch((function(e){return t.Be&&t.Be.close(),Promise.reject(e)}))},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Tr(e,void 0,void 0,(function(){return _r(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt((function(n){return Tr(e,void 0,void 0,(function(){return _r(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((function(){return Tr(e,void 0,void 0,(function(){return _r(this,(function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return ku(e).put(new la(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Je(e).next((function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable((function(){return t.Me(!1)})))}))})).next((function(){return t.Ye(e)})).next((function(n){return t.isPrimary&&!n?t.Xe(e).next((function(){return!1})):!!n&&t.Ze(e).next((function(){return!0}))}))})).catch((function(e){if(Ta(e))return Cr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Cr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Se.enqueueRetryable((function(){return t.Me(e)})),t.isPrimary=e}))},t.prototype.Je=function(t){var e=this;return Ou(t).get(Zs.key).next((function(t){return ma.resolve(e.tn(t))}))},t.prototype.en=function(t){return ku(t).delete(this.clientId)},t.prototype.nn=function(){return Tr(this,void 0,void 0,(function(){var t,e,n,r=this;return _r(this,(function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.$e,18e5)?[3,2]:(this.$e=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=Oa(t,la.store);return e.Nt().next((function(t){var n=r.rn(t,18e5),i=t.filter((function(t){return-1===n.indexOf(t)}));return ma.forEach(i,(function(t){return e.delete(t.clientId)})).next((function(){return i}))}))})).catch((function(){return[]}))]);case 1:if(t=i.sent(),this.Ke)for(e=0,n=t;e<n.length;e++)this.Ke.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}}))}))},t.prototype.ze=function(){var t=this;this.Oe=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.je().then((function(){return t.nn()})).then((function(){return t.ze()}))}))},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?ma.resolve(!0):Ou(t).get(Zs.key).next((function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new Ar(Dr.FAILED_PRECONDITION,Du);return!1}}return!(!e.networkEnabled||!e.inForeground)||ku(t).Nt().next((function(t){return void 0===e.rn(t,5e3).find((function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))}))}))})).next((function(t){return e.isPrimary!==t&&Cr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return Tr(this,void 0,void 0,(function(){var t=this;return _r(this,(function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.Oe&&(this.Oe.cancel(),this.Oe=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Zs.store,la.store],(function(e){var n=new Aa(e,Nr.o);return t.Xe(n).next((function(){return t.en(n)}))}))];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}}))}))},t.prototype.rn=function(t,e){var n=this;return t.filter((function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)}))},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return ku(e).Nt().next((function(e){return t.rn(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return eu.Kt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r,i=this;return Cr("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",pa,(function(o){return r=new Aa(o,i.Ne?i.Ne.next():Nr.o),"readwrite-primary"===e?i.Je(r).next((function(t){return!!t||i.Ye(r)})).next((function(e){if(!e)throw xr("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable((function(){return i.Me(!1)})),new Ar(Dr.FAILED_PRECONDITION,ya);return n(r)})).next((function(t){return i.Ze(r).next((function(){return t}))})):i.dn(r).next((function(){return n(r)}))})).then((function(t){return r.raiseOnCommittedEvent(),t}))},t.prototype.dn=function(t){var e=this;return Ou(t).get(Zs.key).next((function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Ar(Dr.FAILED_PRECONDITION,Du)}))},t.prototype.Ze=function(t){var e=new Zs(this.clientId,this.allowTabSynchronization,Date.now());return Ou(t).put(Zs.key,e)},t.yt=function(){return wa.yt()},t.prototype.Xe=function(t){var e=this,n=Ou(t);return n.get(Zs.key).next((function(t){return e.tn(t)?(Cr("IndexedDbPersistence","Releasing primary lease."),n.delete(Zs.key)):ma.resolve()}))},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(xr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.je()}))},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("unload",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("unload",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Ke)||void 0===e?void 0:e.getItem(this.on(t)));return Cr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return xr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(t){xr("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Ou(t){return Oa(t,Zs.store)}function ku(t){return Oa(t,la.store)}function Cu(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var xu=function(t,e){this.progress=t,this.wn=e},Ru=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.yn(t,e,r)}))},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next((function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t}))},t.prototype.gn=function(t,e){t.forEach((function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)}))},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next((function(e){return n.En(t,e).next((function(){return e}))}))},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(t){return n.gn(e,t)}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return ci.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):$i(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new ci(e)).next((function(t){var e=ts();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=ts();return this.Ut.getCollectionParents(t,i).next((function(s){return ma.forEach(s,(function(s){var a=function(t,e){return new zi(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return o.Rn(t,i=e,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=_i.newInvalidDocument(c),r=r.insert(c,h)),ko(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}}))})).next((function(){return r.forEach((function(t,n){oo(e,n)||(r=r.remove(t))})),r}))},t.prototype.Rn=function(t,e,n){for(var r=is(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Lo&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next((function(t){return t.forEach((function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))})),c}))},t}(),Pu=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=is(),i=is(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Lu=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Gr.min())?this.Dn(t,e):this.Sn.pn(t,r).next((function(o){var s=i.Cn(e,o);return(Wi(e)||Yi(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(kr()<=w.a.DEBUG&&Cr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),io(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next((function(t){return s.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},t.prototype.Cn=function(t,e){var n=new Yo(so(t));return e.forEach((function(e,r){oo(t,r)&&(n=n.add(r))})),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return kr()<=w.a.DEBUG&&Cr("QueryEngine","Using full collection scan to execute query:",io(e)),this.Sn.getDocumentsMatchingQuery(t,e,Gr.min())},t}(),Mu=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new Qo(Vr),this.kn=new mu((function(t){return Di(t)}),Ai),this.On=Gr.min(),this._n=t.getMutationQueue(n),this.$n=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Ru(this.$n,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.Fn)}))},t}();function Fu(t,e,n,r){return new Mu(t,e,n,r)}function qu(t,e){return Tr(this,void 0,void 0,(function(){var n,r,i,o;return _r(this,(function(s){switch(s.label){case 0:return n=Fr(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var o;return n._n.getAllMutationBatches(t).next((function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new Ru(n.$n,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)})).next((function(e){for(var n=[],r=[],s=is(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var y=0,v=p.mutations;y<v.length;y++)s=s.add(v[y].key)}return i.pn(t,s).next((function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}}))}))}))];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}}))}))}function Uu(t,e){var n=Fr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.$n.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=ma.resolve();return o.forEach((function(t){s=s.next((function(){return r.getEntry(e,t)})).next((function(e){var o=n.docVersions.get(t);Mr(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))}))})),s.next((function(){return t._n.removeMutationBatch(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}function Vu(t){var e=Fr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.qe.getLastRemoteSnapshotVersion(t)}))}function ju(t,e){var n=Fr(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.$n.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach((function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next((function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)})));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return Mr(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}}));var a=$o();if(e.documentUpdates.forEach((function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),s.push(Bu(t,o,e.documentUpdates,r,void 0).next((function(t){a=t}))),!r.isEqual(Gr.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next((function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)}));s.push(u)}return ma.waitFor(s).next((function(){return o.apply(t)})).next((function(){return n.Mn.En(t,a)})).next((function(){return a}))})).then((function(t){return n.Fn=i,t}))}function Bu(t,e,n,r,i){var o=is();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=$o();return n.forEach((function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(Gr.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):Cr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)})),o}))}function Ku(t,e){var n=Fr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)}))}function Gu(t,e){var n=Fr(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.qe.getTargetData(t,e).next((function(i){return i?ma.resolve(r=i):n.qe.allocateTargetId(t).next((function(i){return r=new xa(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t}))}function zu(t,e,n){return Tr(this,void 0,void 0,(function(){var r,i,o,s;return _r(this,(function(a){switch(a.label){case 0:r=Fr(t),i=r.Fn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,(function(t){return r.persistence.referenceDelegate.removeTarget(t,i)}))];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!Ta(s=a.sent()))throw s;return Cr("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}}))}))}function Qu(t,e,n){var r=Fr(t),i=Gr.min(),o=is();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=Fr(t),i=r.kn.get(n);return void 0!==i?ma.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,to(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:Gr.min(),n?o:is())})).next((function(t){return{documents:t,Bn:o}}))}))}function Hu(t,e){var n=Fr(t),r=Fr(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.lt(t,e).next((function(t){return t?t.target:null}))}))}function Wu(t){var e=Fr(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=Fr(t),i=$o(),o=Ma(n),s=Tu(e),a=IDBKeyRange.lowerBound(o,!0);return s.Ot({index:oa.readTimeIndex,range:a},(function(t,e){var n=Pa(r.R,e);i=i.insert(n.key,n),o=e.readTime})).next((function(){return{wn:i,readTime:Fa(o)}}))}(e.$n,t,e.On)})).then((function(t){var n=t.wn;return e.On=t.readTime,n}))}function Yu(t){return Tr(this,void 0,void 0,(function(){var e;return _r(this,(function(n){return[2,(e=Fr(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=Tu(t),n=Gr.min();return e.Ot({index:oa.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Fa(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){e.On=t}))]}))}))}function Xu(t,e,n,r){return Tr(this,void 0,void 0,(function(){var i,o,s,a,u,c,h,l,f,d;return _r(this,(function(p){switch(p.label){case 0:for(i=Fr(t),o=is(),s=$o(),a=ns(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Qn(h.metadata.readTime));return f=i.$n.newChangeBuffer({trackRemovals:!0}),[4,Gu(i,function(t){return to(Hi(Yr.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",(function(t){return Bu(t,f,s,Gr.min(),a).next((function(e){return f.apply(t),e})).next((function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next((function(){return i.qe.addMatchingKeys(t,o,d.targetId)})).next((function(){return i.Mn.En(t,e)})).next((function(){return e}))}))}))]}}))}))}function Ju(t,e,n){return void 0===n&&(n=is()),Tr(this,void 0,void 0,(function(){var r,i;return _r(this,(function(o){switch(o.label){case 0:return[4,Gu(t,to(Ka(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=Fr(t)).persistence.runTransaction("Save named query","readwrite",(function(t){var o=Es(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Qe.saveNamedQuery(t,e);var s=r.withResumeToken(Zr.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next((function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)})).next((function(){return i.qe.addMatchingKeys(t,n,r.targetId)})).next((function(){return i.Qe.saveNamedQuery(t,e)}))}))]}}))}))}var $u=function(){function t(t){this.R=t,this.Kn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return ma.resolve(this.Kn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Kn.set(e.id,{id:(n=e).id,version:n.version,createTime:Es(n.createTime)}),ma.resolve()},t.prototype.getNamedQuery=function(t,e){return ma.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:Ka(t.bundledQuery),readTime:Es(t.readTime)}}(e)),ma.resolve()},t}(),Zu=function(){function t(){this.Wn=new Yo(tc.Gn),this.zn=new Yo(tc.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new tc(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},t.prototype.removeReference=function(t,e){this.Yn(new tc(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},t.prototype.Zn=function(t){var e=this,n=new ci(new Yr([])),r=new tc(n,t),i=new tc(n,t+1),o=[];return this.zn.forEachInRange([r,i],(function(t){e.Yn(t),o.push(t.key)})),o},t.prototype.ts=function(){var t=this;this.Wn.forEach((function(e){return t.Yn(e)}))},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new ci(new Yr([])),n=new tc(e,t),r=new tc(e,t+1),i=is();return this.zn.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.containsKey=function(t){var e=new tc(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),tc=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return ci.comparator(t.key,e.key)||Vr(t.ns,e.ns)},t.Hn=function(t,e){return Vr(t.ns,e.ns)||ci.comparator(t.key,e.key)},t}(),ec=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Yo(tc.Gn)}return t.prototype.checkEmpty=function(t){return ma.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new ka(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new tc(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return ma.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return ma.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return ma.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return ma.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return ma.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new tc(e,0),i=new tc(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],(function(t){var e=n.os(t.ns);o.push(e)})),ma.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Yo(Vr);return e.forEach((function(t){var e=new tc(t,0),i=new tc(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],(function(t){r=r.add(t.ns)}))})),ma.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;ci.isDocumentKey(i)||(i=i.child(""));var o=new tc(new ci(i),0),s=new Yo(Vr);return this.rs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)}),o),ma.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.os(t);null!==r&&n.push(r)})),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Mr(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return ma.forEach(e.mutations,(function(i){var o=new tc(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((function(){n.rs=r}))},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new tc(e,0),r=this.rs.firstAfterOrEqual(n);return ma.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return ma.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),nc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Qo(ci.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return ma.resolve(n?n.document.clone():_i.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=$o();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():_i.newInvalidDocument(t))})),ma.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=$o(),i=new ci(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||oo(e,u)&&(r=r.insert(u.key,u.clone()))}return ma.resolve(r)},t.prototype.fs=function(t,e){return ma.forEach(this.docs,(function(t){return e(t)}))},t.prototype.newChangeBuffer=function(t){return new rc(this)},t.prototype.getSize=function(t){return ma.resolve(this.size)},t}(),rc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Er(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)})),ma.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(bu),ic=function(){function t(t){this.persistence=t,this.ds=new mu((function(t){return Di(t)}),Ai),this.lastRemoteSnapshotVersion=Gr.min(),this.highestTargetId=0,this.ws=0,this._s=new Zu,this.targetCount=0,this.ys=su.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach((function(t,n){return e(n)})),ma.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return ma.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return ma.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),ma.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),ma.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new su(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,ma.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),ma.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,ma.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)})),ma.waitFor(o).next((function(){return i}))},t.prototype.getTargetCount=function(t){return ma.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return ma.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),ma.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),ma.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),ma.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return ma.resolve(n)},t.prototype.containsKey=function(t,e){return ma.resolve(this._s.containsKey(e))},t}(),oc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new Nr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new ic(this),this.Ut=new Ha,this.Ue=function(t,e){return new nc(t,(function(t){return n.referenceDelegate.ps(t)}))}(this.Ut),this.R=new Ra(e),this.Qe=new $u(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new ec(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;Cr("MemoryPersistence","Starting transaction:",t);var i=new sc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next((function(t){return r.referenceDelegate.Ts(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.Is=function(t,e){return ma.or(Object.values(this.gs).map((function(n){return function(){return n.containsKey(t,e)}})))},t}(),sc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Er(e,t),e}(va),ac=function(){function t(t){this.persistence=t,this.As=new Zu,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Lr()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),ma.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),ma.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),ma.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach((function(t){return n.vs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.vs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ma.forEach(this.vs,(function(r){var i=ci.fromPath(r);return e.Ps(t,i).next((function(t){t||n.removeEntry(i)}))})).next((function(){return e.Rs=null,n.apply(t)}))},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next((function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())}))},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return ma.or([function(){return ma.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),uc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function cc(t,e){return"firestore_clients_"+t+"_"+e}function hc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function lc(t,e){return"firestore_targets_"+t+"_"+e}uc.UNAUTHENTICATED=new uc(null),uc.GOOGLE_CREDENTIALS=new uc("google-credentials-uid"),uc.FIRST_PARTY=new uc("first-party-uid");var fc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new Ar(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(xr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),dc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Ar(i.error.code,i.error.message)),o?new t(e,i.state,r):(xr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),pc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=ss(),s=0;i&&s<r.activeTargetIds.length;++s)i=ui(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(xr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),yc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(xr("SharedClientState","Failed to parse online state: "+e),null)},t}(),vc=function(){function t(){this.activeTargetIds=ss()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),gc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new Qo(Vr),this.started=!1,this.Os=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.$s=cc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new vc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Qs=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Tr(this,void 0,void 0,(function(){var t,e,n,r,i,o,s,a,u,c,h=this;return _r(this,(function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(cc(this.persistenceKey,r)))&&(o=pc.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Ks(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.Os;u<c.length;u++)this.Fs(c[u]);return this.Os=[],this.window.addEventListener("unload",(function(){return h.shutdown()})),this.started=!0,[2]}}))}))},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(lc(this.persistenceKey,t));if(n){var r=dc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Ks(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Ks()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(lc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.Hs(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.$s),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Cr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){Cr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Cr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(Cr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.$s)return void xr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable((function(){return Tr(e,void 0,void 0,(function(){var t,e,r,i,o,s;return _r(this,(function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=Nr.o;if(null!=t)try{var n=JSON.parse(t);Mr("number"==typeof n),e=n}catch(t){xr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Nr.o&&this.sequenceNumberHandler(s);else if(n.key===this.Qs)return[2,this.syncEngine.ci()]}else this.Os.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Ks=function(){this.setItem(this.$s,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new fc(this.currentUser,t,e,n),i=hc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=hc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=lc(this.persistenceKey,t),i=new dc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return pc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return fc.Vs(new uc(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return dc.Vs(r,e)},t.prototype.js=function(t){return yc.Vs(t)},t.prototype.ii=function(t){return Tr(this,void 0,void 0,(function(){return _r(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(Cr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||a.push(t)})),this.syncEngine.hi(s,a).then((function(){n.ks=r}))},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=ss();return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},t}(),mc=function(){function t(){this.li=new vc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new vc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),bc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),wc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){Cr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){Cr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Ic={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Ec=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),Tc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n}return Er(e,t),e.prototype.ki=function(t,e,n,r){return new Promise((function(i,o){var s=new wr;s.listenOnce(gr.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case vr.NO_ERROR:var e=s.getResponseJson();Cr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case vr.TIMEOUT:Cr("Connection",'RPC "'+t+'" timed out'),o(new Ar(Dr.DEADLINE_EXCEEDED,"Request time out"));break;case vr.HTTP_ERROR:var n=s.getStatus();if(Cr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(Dr).indexOf(e)>=0?e:Dr.UNKNOWN}(r.status);o(new Ar(a,r.message))}else o(new Ar(Dr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Ar(Dr.UNAVAILABLE,"Connection failed."));break;default:Lr()}}finally{Cr("Connection",'RPC "'+t+'" completed.')}}));var a=JSON.stringify(r);s.send(e,"POST",a,n,15)}))},e.prototype.$i=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new lr,i=de(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Fi(o.initMessageHeaders,e),Object(b.m)()||Object(b.o)()||Object(b.k)()||Object(b.l)()||Object(b.p)()||Object(b.j)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");Cr("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,c=!1,h=new Ec({Ei:function(t){c?Cr("Connection","Not sending because WebChannel is closed:",t):(u||(Cr("Connection","Opening WebChannel transport."),a.open(),u=!0),Cr("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),l=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return l(a,br.EventType.OPEN,(function(){c||Cr("Connection","WebChannel transport opened.")})),l(a,br.EventType.CLOSE,(function(){c||(c=!0,Cr("Connection","WebChannel transport closed"),h.Vi())})),l(a,br.EventType.ERROR,(function(t){c||(c=!0,Rr("Connection","WebChannel transport errored:",t),h.Vi(new Ar(Dr.UNAVAILABLE,"The operation could not be completed")))})),l(a,br.EventType.MESSAGE,(function(t){var e;if(!c){var n=t.data[0];Mr(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Cr("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=Uo[t];if(void 0!==e)return zo(e)}(i),s=r.message;void 0===o&&(o=Dr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new Ar(o,s)),a.close()}else Cr("Connection","WebChannel received:",n),h.Si(n)}})),l(i,mr.STAT_EVENT,(function(t){10===t.stat?Cr("Connection","Detected buffering proxy"):11===t.stat&&Cr("Connection","Detected no buffering proxy")})),setTimeout((function(){h.Pi()}),0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);Cr("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then((function(t){return Cr("RestConnection","Received: ",t),t}),(function(e){throw Rr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.Oi=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.3.2",t["X-Firebase-GMPID"]=this.databaseInfo.appId,t["Content-Type"]="text/plain",e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+Ic[t]},t}());function _c(){return"undefined"!=typeof window?window:null}function Sc(){return"undefined"!=typeof document?document:null}function Nc(t){return new ms(t,!0)}var Dc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Ki=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);i>0&&Cr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,(function(){return e.Qi=Date.now(),t()})),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),Ac=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Dc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Tr(this,void 0,void 0,(function(){return _r(this,(function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(function(){return t.rr()})))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return Tr(this,void 0,void 0,(function(){return _r(this,(function(t){return this.er()?[2,this.close(0)]:[2]}))}))},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Tr(this,void 0,void 0,(function(){return _r(this,(function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===Dr.RESOURCE_EXHAUSTED?(xr(e.toString()),xr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):e&&e.code===Dr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then((function(e){t.Yi===n&&t.lr(e)}),(function(n){e((function(){var e=new Ar(Dr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)}))}))},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((function(){n((function(){return e.state=2,e.listener.Ii()}))})),this.stream.Ri((function(t){n((function(){return e.dr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji((function(){return Tr(t,void 0,void 0,(function(){return _r(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.dr=function(t){return Cr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget((function(){return e.Yi===t?n():(Cr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),Oc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return Er(e,t),e.prototype.wr=function(t){return this.Hi.$i("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Lr()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(Mr(void 0===e||"string"==typeof e),Zr.fromBase64String(e||"")):(Mr(void 0===e||e instanceof Uint8Array),Zr.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?Dr.UNKNOWN:zo(t.code);return new Ar(e,t.message||"")}(a);n=new ls(r,i,o,s||null)}else if("documentChange"in e){i=Ns(t,(r=e.documentChange).document.name),o=Es(r.document.updateTime);var a=new Ei({mapValue:{fields:r.document.fields}}),u=(s=_i.newFoundDocument(i,o,a),r.targetIds||[]);n=new cs(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=Ns(t,(r=e.documentDelete).document),o=r.readTime?Es(r.readTime):Gr.min(),a=_i.newNoDocument(i,o),n=new cs([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=Ns(t,(r=e.documentRemove).document),n=new cs([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return Lr();var c=e.filter;i=new Ko(r=c.count||0),n=new hs(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return Gr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Gr.min():e.readTime?Es(e.readTime):Gr.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=Os(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=Oi(r)?{documents:Ls(t,r)}:{query:Ms(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=ws(t,e.resumeToken):e.snapshotVersion.compareTo(Gr.min())>0&&(n.readTime=bs(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Lr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=Os(this.R),e.removeTarget=t,this.cr(e)},e}(Ac),kc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return Er(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.$i("Write",t)},e.prototype.onMessage=function(t){if(Mr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(Mr(void 0!==e),t.map((function(t){return function(t,e){var n=Es(t.updateTime?t.updateTime:e);return n.isEqual(Gr.min())&&(n=Es(e)),new So(n,t.transformResults||[])}(t,e)}))):[]}(t.writeResults,t.commitTime),n=Es(t.commitTime);return this.listener.Tr(n,e)}return Mr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=Os(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return Rs(e.R,t)}))};this.cr(n)},e}(Ac),Cc=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Er(e,t),e.prototype.br=function(){if(this.Rr)throw new Ar(Dr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Ni(t,e,n,i)})).catch((function(t){throw t.code===Dr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t}))},e.prototype.Oi=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Oi(t,e,n,i)})).catch((function(t){throw t.code===Dr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t}))},e.prototype.terminate=function(){this.Rr=!1},e}((function(){})),xc=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()})))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(xr(e),this.Vr=!1):Cr("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),Rc=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.Or=new Map,this.$r=new Set,this.Mr=[],this.Lr=i,this.Lr.di((function(t){n.enqueueAndForget((function(){return Tr(o,void 0,void 0,(function(){return _r(this,(function(t){switch(t.label){case 0:return Bc(this)?(Cr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Tr(this,void 0,void 0,(function(){var e;return _r(this,(function(n){switch(n.label){case 0:return(e=Fr(t)).$r.add(4),[4,Lc(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.$r.delete(4),[4,Pc(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Br=new xc(n,r)};function Pc(t){return Tr(this,void 0,void 0,(function(){var e,n;return _r(this,(function(r){switch(r.label){case 0:if(!Bc(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Lc(t){return Tr(this,void 0,void 0,(function(){var e,n;return _r(this,(function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Mc(t,e){var n=Fr(t);n.Or.has(e.targetId)||(n.Or.set(e.targetId,e),jc(n)?Vc(n):rh(n).er()&&qc(n,e))}function Fc(t,e){var n=Fr(t),r=rh(n);n.Or.delete(e),r.er()&&Uc(n,e),0===n.Or.size&&(r.er()?r.ir():Bc(n)&&n.Br.set("Unknown"))}function qc(t,e){t.qr.U(e.targetId),rh(t).mr(e)}function Uc(t,e){t.qr.U(e),rh(t).yr(e)}function Vc(t){t.qr=new ds({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.Or.get(e)||null}}),rh(t).start(),t.Br.Sr()}function jc(t){return Bc(t)&&!rh(t).tr()&&t.Or.size>0}function Bc(t){return 0===Fr(t).$r.size}function Kc(t){t.qr=void 0}function Gc(t){return Tr(this,void 0,void 0,(function(){return _r(this,(function(e){return t.Or.forEach((function(e,n){qc(t,e)})),[2]}))}))}function zc(t,e){return Tr(this,void 0,void 0,(function(){return _r(this,(function(n){return Kc(t),jc(t)?(t.Br.Nr(e),Vc(t)):t.Br.set("Unknown"),[2]}))}))}function Qc(t,e,n){return Tr(this,void 0,void 0,(function(){var r,i,o;return _r(this,(function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof ls&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Tr(this,void 0,void 0,(function(){var n,r,i,o;return _r(this,(function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.Or.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.Or.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),Cr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,Hc(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof cs?t.qr.X(e):e instanceof hs?t.qr.rt(e):t.qr.et(e),n.isEqual(Gr.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,Vu(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.Or.get(r);i&&t.Or.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((function(e){var n=t.Or.get(e);if(n){t.Or.set(e,n.withResumeToken(Zr.EMPTY_BYTE_STRING,n.snapshotVersion)),Uc(t,e);var r=new xa(n.target,e,1,n.sequenceNumber);qc(t,r)}})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return Cr("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,Hc(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}}))}))}function Hc(t,e,n){return Tr(this,void 0,void 0,(function(){var r=this;return _r(this,(function(i){switch(i.label){case 0:if(!Ta(e))throw e;return t.$r.add(1),[4,Lc(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return Vu(t.localStore)}),t.asyncQueue.enqueueRetryable((function(){return Tr(r,void 0,void 0,(function(){return _r(this,(function(e){switch(e.label){case 0:return Cr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.$r.delete(1),[4,Pc(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Wc(t,e){return e().catch((function(n){return Hc(t,n,e)}))}function Yc(t){return Tr(this,void 0,void 0,(function(){var e,n,r,i,o;return _r(this,(function(s){switch(s.label){case 0:e=Fr(t),n=ih(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return Bc(t)&&t.kr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,Ku(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=ih(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,Hc(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return Xc(e)&&Jc(e),[2]}}))}))}function Xc(t){return Bc(t)&&!ih(t).tr()&&t.kr.length>0}function Jc(t){ih(t).start()}function $c(t){return Tr(this,void 0,void 0,(function(){return _r(this,(function(e){return ih(t).Ar(),[2]}))}))}function Zc(t){return Tr(this,void 0,void 0,(function(){var e,n,r;return _r(this,(function(i){for(e=ih(t),n=0,r=t.kr;n<r.length;n++)e.Er(r[n].mutations);return[2]}))}))}function th(t,e,n){return Tr(this,void 0,void 0,(function(){var r,i;return _r(this,(function(o){switch(o.label){case 0:return r=t.kr.shift(),i=Ca.from(r,e,n),[4,Wc(t,(function(){return t.remoteSyncer.applySuccessfulWrite(i)}))];case 1:return o.sent(),[4,Yc(t)];case 2:return o.sent(),[2]}}))}))}function eh(t,e){return Tr(this,void 0,void 0,(function(){return _r(this,(function(n){switch(n.label){case 0:return e&&ih(t).pr?[4,function(t,e){return Tr(this,void 0,void 0,(function(){var n,r;return _r(this,(function(i){switch(i.label){case 0:return Go(r=e.code)&&r!==Dr.ABORTED?(n=t.kr.shift(),ih(t).sr(),[4,Wc(t,(function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,Yc(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Xc(t)&&Jc(t),[2]}}))}))}function nh(t,e){return Tr(this,void 0,void 0,(function(){var n;return _r(this,(function(r){switch(r.label){case 0:return n=Fr(t),e?(n.$r.delete(2),[4,Pc(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.$r.add(2),[4,Lc(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function rh(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=Fr(t);return r.br(),new Oc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Gc.bind(null,t),Ri:zc.bind(null,t),_r:Qc.bind(null,t)}),t.Mr.push((function(n){return Tr(e,void 0,void 0,(function(){return _r(this,(function(e){switch(e.label){case 0:return n?(t.Ur.sr(),jc(t)?Vc(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),Kc(t),e.label=3;case 3:return[2]}}))}))}))),t.Ur}function ih(t){var e=this;return t.Qr||(t.Qr=function(t,e,n){var r=Fr(t);return r.br(),new kc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:$c.bind(null,t),Ri:eh.bind(null,t),Ir:Zc.bind(null,t),Tr:th.bind(null,t)}),t.Mr.push((function(n){return Tr(e,void 0,void 0,(function(){return _r(this,(function(e){switch(e.label){case 0:return n?(t.Qr.sr(),[4,Yc(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Qr.stop()];case 3:e.sent(),t.kr.length>0&&(Cr("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}}))}))}))),t.Qr}var oh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new ga,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ar(Dr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function sh(t,e){if(xr("AsyncQueue",e+": "+t),Ta(t))return new Ar(Dr.UNAVAILABLE,e+": "+t);throw t}var ah=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||ci.comparator(e.key,n.key)}:function(t,e){return ci.comparator(t.key,e.key)},this.keyedMap=ts(),this.sortedSet=new Qo(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),uh=function(){function t(){this.Kr=new Qo(ci.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);n?0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):Lr():this.Kr=this.Kr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Kr.inorderTraversal((function(e,n){t.push(n)})),t},t}(),ch=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,ah.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&no(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),hh=function(){this.Wr=void 0,this.listeners=[]},lh=function(){this.queries=new mu((function(t){return ro(t)}),no),this.onlineState="Unknown",this.Gr=new Set};function fh(t,e){return Tr(this,void 0,void 0,(function(){var n,r,i,o,s,a,u;return _r(this,(function(c){switch(c.label){case 0:if(n=Fr(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new hh),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=sh(a,"Initialization of query '"+io(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&vh(n),[2]}}))}))}function dh(t,e){return Tr(this,void 0,void 0,(function(){var n,r,i,o,s;return _r(this,(function(a){return n=Fr(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]}))}))}function ph(t,e){for(var n=Fr(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&vh(n)}function yh(t,e,n){var r=Fr(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function vh(t){t.Gr.forEach((function(t){t.next()}))}var gh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new ch(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=ch.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),mh=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),bh=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return Ns(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?xs(this.R,t.document,!1):_i.newNoDocument(this.qn(t.metadata.name),this.Qn(t.metadata.readTime))},t.prototype.Qn=function(t){return Es(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new bh(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||is()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return Tr(this,void 0,void 0,(function(){var t,e,n,r,i;return _r(this,(function(o){switch(o.label){case 0:return[4,Xu(this.localStore,new bh(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,Ju(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new xu(Object.assign({},this.progress),t))]}}))}))}}();var wh=function(t){this.key=t},Ih=function(t){this.key=t},Eh=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=is(),this.mutatedKeys=is(),this.lo=so(t),this.fo=new ah(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new uh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=Wi(this.query)&&i.size===this.query.limit?i.last():null,c=Yi(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=oo(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),Wi(this.query)||Yi(this.query))for(;s.size>this.query.limit;){var h=Wi(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Lr()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)})),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new ch(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new uh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e.uo=e.uo.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e.uo=e.uo.delete(t)})),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=is(),this.fo.forEach((function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))}));var n=[];return e.forEach((function(e){t.ho.has(e)||n.push(new Ih(e))})),this.ho.forEach((function(t){e.has(t)||n.push(new wh(t))})),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=is();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return ch.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),Th=function(t,e,n){this.query=t,this.targetId=e,this.view=n},_h=function(t){this.key=t,this.bo=!1},Sh=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new mu((function(t){return ro(t)}),no),this.Vo=new Map,this.So=new Set,this.Do=new Qo(ci.comparator),this.Co=new Map,this.No=new Zu,this.xo={},this.Fo=new Map,this.ko=su.Yt(),this.onlineState="Unknown",this.Oo=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.Oo},enumerable:!1,configurable:!0}),t}();function Nh(t,e){return Tr(this,void 0,void 0,(function(){var n,r,i,o,s;return _r(this,(function(a){switch(a.label){case 0:return n=el(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,Gu(n.localStore,to(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,Dh(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&Mc(n.remoteStore,o),a.label=4;case 4:return[2,r]}}))}))}function Dh(t,e,n,r){return Tr(this,void 0,void 0,(function(){var i,o,s,a,u,c;return _r(this,(function(h){switch(h.label){case 0:return t.$o=function(e,n,r){return function(t,e,n,r){return Tr(this,void 0,void 0,(function(){var i,o,s;return _r(this,(function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,Qu(t.localStore,e.query,!1).then((function(t){return e.view._o(t.documents,i)}))]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(Vh(t,e.targetId,s.To),s.snapshot)]}}))}))}(t,e,n,r)},[4,Qu(t.localStore,e,!0)];case 1:return i=h.sent(),o=new Eh(e,i.Bn),s=o._o(i.documents),a=us.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),Vh(t,n,u.To),c=new Th(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}}))}))}function Ah(t,e){return Tr(this,void 0,void 0,(function(){var n,r,i;return _r(this,(function(o){switch(o.label){case 0:return n=Fr(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter((function(t){return!no(t,e)}))),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,zu(n.localStore,r.targetId,!1).then((function(){n.sharedClientState.clearQueryState(r.targetId),Fc(n.remoteStore,r.targetId),qh(n,r.targetId)})).catch(lu)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return qh(n,r.targetId),[4,zu(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}function Oh(t,e,n){return Tr(this,void 0,void 0,(function(){var r,i,o,s;return _r(this,(function(a){switch(a.label){case 0:r=nl(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=Fr(t),i=Kr.now(),o=e.reduce((function(t,e){return t.add(e.key)}),is());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Mn.pn(t,o).next((function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=Co(c,n.get(c.key));null!=h&&s.push(new Lo(c.key,h,Ti(h.toProto().mapValue),No.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)}))})).then((function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}}))}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Qo(Vr)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,Kh(r,i.changes)];case 3:return a.sent(),[4,Yc(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=sh(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}}))}))}function kh(t,e){return Tr(this,void 0,void 0,(function(){var n,r;return _r(this,(function(i){switch(i.label){case 0:n=Fr(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,ju(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach((function(t,e){var r=n.Co.get(e);r&&(Mr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?Mr(r.bo):t.removedDocuments.size>0&&(Mr(r.bo),r.bo=!1))})),[4,Kh(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,lu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function Ch(t,e,n){var r=Fr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach((function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=Fr(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)})),r&&vh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function xh(t,e,n){return Tr(this,void 0,void 0,(function(){var r,i,o,s,a,u;return _r(this,(function(c){switch(c.label){case 0:return(r=Fr(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new Qo(ci.comparator)).insert(o,_i.newNoDocument(o,Gr.min())),a=is().add(o),u=new as(Gr.min(),new Map,new Yo(Vr),s,a),[4,kh(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),Bh(r),[3,4];case 2:return[4,zu(r.localStore,e,!1).then((function(){return qh(r,e,n)})).catch(lu)];case 3:c.sent(),c.label=4;case 4:return[2]}}))}))}function Rh(t,e){return Tr(this,void 0,void 0,(function(){var n,r,i;return _r(this,(function(o){switch(o.label){case 0:n=Fr(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,Uu(n.localStore,e)];case 2:return i=o.sent(),Fh(n,r,null),Mh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Kh(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,lu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function Ph(t,e,n){return Tr(this,void 0,void 0,(function(){var r,i;return _r(this,(function(o){switch(o.label){case 0:r=Fr(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=Fr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n._n.lookupMutationBatch(t,e).next((function(e){return Mr(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}(r.localStore,e)];case 2:return i=o.sent(),Fh(r,e,n),Mh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Kh(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,lu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function Lh(t,e){return Tr(this,void 0,void 0,(function(){var n,r,i,o,s;return _r(this,(function(a){switch(a.label){case 0:Bc((n=Fr(t)).remoteStore)||Cr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=Fr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e._n.getHighestUnacknowledgedBatchId(t)}))}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=a.sent(),s=sh(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}}))}))}function Mh(t,e){(t.Fo.get(e)||[]).forEach((function(t){t.resolve()})),t.Fo.delete(e)}function Fh(t,e,n){var r=Fr(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function qh(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach((function(e){t.No.containsKey(e)||Uh(t,e)}))}function Uh(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Fc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Bh(t))}function Vh(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof wh?(t.No.addReference(o.key,e),jh(t,o)):o instanceof Ih?(Cr("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Uh(t,o.key)):Lr()}}function jh(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(Cr("SyncEngine","New document in limbo: "+n),t.So.add(r),Bh(t))}function Bh(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new ci(Yr.fromString(e)),r=t.ko.next();t.Co.set(r,new _h(n)),t.Do=t.Do.insert(n,r),Mc(t.remoteStore,new xa(to(Hi(n.path)),r,2,Nr.o))}}function Kh(t,e,n){return Tr(this,void 0,void 0,(function(){var r,i,o,s;return _r(this,(function(a){switch(a.label){case 0:return r=Fr(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach((function(t,a){s.push(r.$o(a,e,n).then((function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=Pu.Pn(a.targetId,t);o.push(e)}})))})),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return Tr(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c;return _r(this,(function(h){switch(h.label){case 0:n=Fr(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return ma.forEach(e,(function(e){return ma.forEach(e.bn,(function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)})).next((function(){return ma.forEach(e.vn,(function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)}))}))}))}))];case 2:return h.sent(),[3,4];case 3:if(!Ta(r=h.sent()))throw r;return Cr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(u=n.Fn.get(a),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.Fn=n.Fn.insert(a,c));return[2]}}))}))}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}}))}))}function Gh(t,e){return Tr(this,void 0,void 0,(function(){var n,r;return _r(this,(function(i){switch(i.label){case 0:return(n=Fr(t)).currentUser.isEqual(e)?[3,3]:(Cr("SyncEngine","User change. New user:",e.toKey()),[4,qu(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach((function(t){t.forEach((function(t){t.reject(new Ar(Dr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Kh(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}function zh(t,e){var n=Fr(t),r=n.Co.get(e);if(r&&r.bo)return is().add(r.key);var i=is(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function Qh(t,e){return Tr(this,void 0,void 0,(function(){var n,r,i;return _r(this,(function(o){switch(o.label){case 0:return[4,Qu((n=Fr(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&Vh(n,e.targetId,i.To),i)]}}))}))}function Hh(t){return Tr(this,void 0,void 0,(function(){var e;return _r(this,(function(n){return[2,Wu((e=Fr(t)).localStore).then((function(t){return Kh(e,t)}))]}))}))}function Wh(t,e,n,r){return Tr(this,void 0,void 0,(function(){var i,o;return _r(this,(function(s){switch(s.label){case 0:return[4,function(t,e){var n=Fr(t),r=Fr(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.jt(t,e).next((function(e){return e?n.Mn.pn(t,e):ma.resolve(null)}))}))}((i=Fr(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,Yc(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Fh(i,e,r||null),Mh(i,e),function(t,e){Fr(Fr(t)._n).Gt(e)}(i.localStore,e)):Lr(),s.label=4;case 4:return[4,Kh(i,o)];case 5:return s.sent(),[3,7];case 6:Cr("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}}))}))}function Yh(t,e){return Tr(this,void 0,void 0,(function(){var n,r,i,o,s,a,u;return _r(this,(function(c){switch(c.label){case 0:return el(n=Fr(t)),nl(n),!0!==e||!0===n.Oo?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,Xh(n,r.toArray())]);case 1:return i=c.sent(),n.Oo=!0,[4,nh(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)Mc(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.Oo?[3,7]:(a=[],u=Promise.resolve(),n.Vo.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):u=u.then((function(){return qh(n,e),zu(n.localStore,e,!0)})),Fc(n.remoteStore,e)})),[4,u]);case 4:return c.sent(),[4,Xh(n,a)];case 5:return c.sent(),function(t){var e=Fr(t);e.Co.forEach((function(t,n){Fc(e.remoteStore,n)})),e.No.ts(),e.Co=new Map,e.Do=new Qo(ci.comparator)}(n),n.Oo=!1,[4,nh(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}}))}))}function Xh(t,e,n){return Tr(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c,h,l,f,d,p;return _r(this,(function(y){switch(y.label){case 0:n=Fr(t),r=[],i=[],o=0,s=e,y.label=1;case 1:return o<s.length?(u=void 0,(c=n.Vo.get(a=s[o]))&&0!==c.length?[4,Gu(n.localStore,to(c[0]))]:[3,7]):[3,13];case 2:u=y.sent(),h=0,l=c,y.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,Qh(n,f)]):[3,6];case 4:(d=y.sent()).snapshot&&i.push(d.snapshot),y.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,Hu(n.localStore,a)];case 8:return p=y.sent(),[4,Gu(n.localStore,p)];case 9:return u=y.sent(),[4,Dh(n,Jh(p),a,!1)];case 10:y.sent(),y.label=11;case 11:r.push(u),y.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}}))}))}function Jh(t){return Qi(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function $h(t){var e=Fr(t);return Fr(Fr(e.localStore).persistence).fn()}function Zh(t,e,n,r){return Tr(this,void 0,void 0,(function(){var i,o,s;return _r(this,(function(a){switch(a.label){case 0:return(i=Fr(t)).Oo?(Cr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Wu(i.localStore)];case 3:return o=a.sent(),s=as.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Kh(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,zu(i.localStore,e,!0)];case 6:return a.sent(),qh(i,e,r),[3,8];case 7:Lr(),a.label=8;case 8:return[2]}}))}))}function tl(t,e,n){return Tr(this,void 0,void 0,(function(){var r,i,o,s,a,u,c,h,l;return _r(this,(function(f){switch(f.label){case 0:if(!(r=el(t)).Oo)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(Cr("SyncEngine","Adding an already active target "+s),[3,5]):[4,Hu(r.localStore,s)]:[3,6];case 2:return a=f.sent(),[4,Gu(r.localStore,a)];case 3:return u=f.sent(),[4,Dh(r,Jh(a),u.targetId,!1)];case 4:f.sent(),Mc(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return _r(this,(function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,zu(r.localStore,t,!1).then((function(){Fc(r.remoteStore,t),qh(r,t)})).catch(lu)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}}))}))}function el(t){var e=Fr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=kh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=zh.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=xh.bind(null,e),e.vo._r=ph.bind(null,e.eventManager),e.vo.Mo=yh.bind(null,e.eventManager),e}function nl(t){var e=Fr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Rh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Ph.bind(null,e),e}var rl=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Tr(this,void 0,void 0,(function(){return _r(this,(function(e){switch(e.label){case 0:return this.R=Nc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Qo(t),[2]}}))}))},t.prototype.Uo=function(t){return null},t.prototype.Qo=function(t){return Fu(this.persistence,new Lu,t.initialUser,this.R)},t.prototype.qo=function(t){return new oc(ac.bs,this.R)},t.prototype.Bo=function(t){return new mc},t.prototype.terminate=function(){return Tr(this,void 0,void 0,(function(){return _r(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},t}(),il=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Ko=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Er(e,t),e.prototype.initialize=function(e){return Tr(this,void 0,void 0,(function(){return _r(this,(function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,Yu(this.localStore)];case 2:return n.sent(),[4,this.Ko.initialize(this,e)];case 3:return n.sent(),[4,nl(this.Ko.syncEngine)];case 4:return n.sent(),[4,Yc(this.Ko.remoteStore)];case 5:return n.sent(),[2]}}))}))},e.prototype.Qo=function(t){return Fu(this.persistence,new Lu,t.initialUser,this.R)},e.prototype.Uo=function(t){return new pu(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=Cu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?$a.withCacheSize(this.cacheSizeBytes):$a.DEFAULT;return new Au(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,_c(),Sc(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new mc},e}(rl),ol=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Ko=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Er(e,t),e.prototype.initialize=function(e){return Tr(this,void 0,void 0,(function(){var n,r=this;return _r(this,(function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Ko.syncEngine,this.sharedClientState instanceof gc?(this.sharedClientState.syncEngine={ui:Wh.bind(null,n),ai:Zh.bind(null,n),hi:tl.bind(null,n),fn:$h.bind(null,n),ci:Hh.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He((function(t){return Tr(r,void 0,void 0,(function(){return _r(this,(function(e){switch(e.label){case 0:return[4,Yh(this.Ko.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return i.sent(),[2]}}))}))},e.prototype.Bo=function(t){var e=_c();if(!gc.yt(e))throw new Ar(Dr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Cu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new gc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(il),sl=function(){function t(){}return t.prototype.initialize=function(t,e){return Tr(this,void 0,void 0,(function(){var n=this;return _r(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Ch(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Gh.bind(null,this.syncEngine),[4,nh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.createEventManager=function(t){return new lh},t.prototype.createDatastore=function(t){var e=Nc(t.databaseInfo.databaseId),n=new Tc(t.databaseInfo);return function(t,e,n){return new Cc(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Ch(s.syncEngine,t,0)},o=wc.yt()?new wc:new bc,new Rc(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new Sh(t,e,n,r,i,o);return s&&(a.Oo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Tr(this,void 0,void 0,(function(){var e;return _r(this,(function(n){switch(n.label){case 0:return e=Fr(t),Cr("RemoteStore","RemoteStore shutting down."),e.$r.add(5),[4,Lc(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}}))}))}(this.remoteStore)},t}(),al=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),ul=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new ga,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then((function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))}),(function(t){return n.metadata.reject(t)}))}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Tr(this,void 0,void 0,(function(){return _r(this,(function(t){return[2,this.metadata.promise]}))}))},t.prototype.Lo=function(){return Tr(this,void 0,void 0,(function(){return _r(this,(function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}}))}))},t.prototype.Ho=function(){return Tr(this,void 0,void 0,(function(){var t,e,n,r;return _r(this,(function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new mh(JSON.parse(r),t.length+n)]}}))}))},t.prototype.Zo=function(){return this.buffer.findIndex((function(t){return t==="{".charCodeAt(0)}))},t.prototype.Jo=function(){return Tr(this,void 0,void 0,(function(){var t,e;return _r(this,(function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}}))}))},t.prototype.Xo=function(t){return Tr(this,void 0,void 0,(function(){var e;return _r(this,(function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}}))}))},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Tr(this,void 0,void 0,(function(){var t,e;return _r(this,(function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}}))}))}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Tr(this,void 0,void 0,(function(){var e,n=this;return _r(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Ar(Dr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Tr(this,void 0,void 0,(function(){var n,r,i,o,s,a;return _r(this,(function(u){switch(u.label){case 0:return n=Fr(t),r=Os(n.R)+"/documents",i={documents:e.map((function(t){return Ss(n.R,t)}))},[4,n.Oi("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){Mr(!!e.found);var n=Ns(t,e.found.name),r=Es(e.found.updateTime),i=new Ei({mapValue:{fields:e.found.fields}});return _i.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){Mr(!!e.missing),Mr(!!e.readTime);var n=Ns(t,e.missing),r=Es(e.readTime);return _i.newNoDocument(n,r)}(t,e):Lr()}(n.R,t);s.set(e.key.toString(),e)})),a=[],[2,(e.forEach((function(t){var e=s.get(t.toString());Mr(!!e),a.push(e)})),a)]}}))}))}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach((function(t){return n.recordVersion(t)})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new jo(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Tr(this,void 0,void 0,(function(){var t,e=this;return _r(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=ci.fromPath(n);e.mutations.push(new Bo(r,e.precondition(r)))})),[4,function(t,e){return Tr(this,void 0,void 0,(function(){var n,r,i;return _r(this,(function(o){switch(o.label){case 0:return n=Fr(t),r=Os(n.R)+"/documents",i={writes:e.map((function(t){return Rs(n.R,t)}))},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Lr();e=Gr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Ar(Dr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?No.updateTime(e):No.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Gr.min()))throw new Ar(Dr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return No.updateTime(e)}return No.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),cl=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new Dc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji((function(){return Tr(t,void 0,void 0,(function(){var t,e,n=this;return _r(this,(function(r){return t=new ul(this.datastore),(e=this.sc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.ic(t)}))}))})).catch((function(t){n.ic(t)})),[2]}))}))}))},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!si(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget((function(){return e.nc(),Promise.resolve()}))):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Go(e)}return!1},t}(),hl=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=uc.UNAUTHENTICATED,this.clientId=Ur.u(),this.credentialListener=function(){},this.receivedInitialUser=new ga,this.credentials.setChangeListener((function(t){Cr("FirestoreClient","Received user=",t.uid),r.user=t,r.credentialListener(t),r.receivedInitialUser.resolve()}))}return t.prototype.getConfiguration=function(){return Tr(this,void 0,void 0,(function(){return _r(this,(function(t){switch(t.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return[2,(t.sent(),{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100})]}}))}))},t.prototype.setCredentialChangeListener=function(t){var e=this;this.credentialListener=t,this.receivedInitialUser.promise.then((function(){return e.credentialListener(e.user)}))},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Ar(Dr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new ga;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return Tr(t,void 0,void 0,(function(){var t,n;return _r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=sh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();function ll(t,e){return Tr(this,void 0,void 0,(function(){var n,r,i=this;return _r(this,(function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),Cr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener((function(n){r.isEqual(n)||(r=n,t.asyncQueue.enqueueRetryable((function(){return Tr(i,void 0,void 0,(function(){return _r(this,(function(t){switch(t.label){case 0:return[4,qu(e.localStore,n)];case 1:return t.sent(),[2]}}))}))})))})),e.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=e,[2]}}))}))}function fl(t,e){return Tr(this,void 0,void 0,(function(){var n,r;return _r(this,(function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,dl(t)];case 1:return n=i.sent(),Cr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener((function(n){return t.asyncQueue.enqueueRetryable((function(){return function(t,e){return Tr(this,void 0,void 0,(function(){var n,r;return _r(this,(function(i){switch(i.label){case 0:return(n=Fr(t)).asyncQueue.verifyOperationInProgress(),Cr("RemoteStore","RemoteStore received new credentials"),r=Bc(n),n.$r.add(3),[4,Lc(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.$r.delete(3),[4,Pc(n)];case 3:return i.sent(),[2]}}))}))}(e.remoteStore,n)}))})),t.onlineComponents=e,[2]}}))}))}function dl(t){return Tr(this,void 0,void 0,(function(){return _r(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Cr("FirestoreClient","Using default OfflineComponentProvider"),[4,ll(t,new rl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function pl(t){return Tr(this,void 0,void 0,(function(){return _r(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Cr("FirestoreClient","Using default OnlineComponentProvider"),[4,fl(t,new sl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function yl(t){return dl(t).then((function(t){return t.persistence}))}function vl(t){return dl(t).then((function(t){return t.localStore}))}function gl(t){return pl(t).then((function(t){return t.remoteStore}))}function ml(t){return pl(t).then((function(t){return t.syncEngine}))}function bl(t){return Tr(this,void 0,void 0,(function(){var e,n;return _r(this,(function(r){switch(r.label){case 0:return[4,pl(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=Nh.bind(null,e.syncEngine),n.onUnlisten=Ah.bind(null,e.syncEngine),n)]}}))}))}function wl(t,e,n){var r=this;void 0===n&&(n={});var i=new ga;return t.asyncQueue.enqueueAndForget((function(){return Tr(r,void 0,void 0,(function(){var r;return _r(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new al({next:function(o){e.enqueueAndForget((function(){return dh(t,s)}));var a=o.docs.has(n);!a&&o.fromCache?i.reject(new Ar(Dr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new Ar(Dr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new gh(Hi(n.path),o,{includeMetadataChanges:!0,so:!0});return fh(t,s)},[4,bl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}function Il(t,e,n){var r=this;void 0===n&&(n={});var i=new ga;return t.asyncQueue.enqueueAndForget((function(){return Tr(r,void 0,void 0,(function(){var r;return _r(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new al({next:function(n){e.enqueueAndForget((function(){return dh(t,s)})),n.fromCache&&"server"===r.source?i.reject(new Ar(Dr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new gh(n,o,{includeMetadataChanges:!0,so:!0});return fh(t,s)},[4,bl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}var El=function(t,e,n,r,i,o,s){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s},Tl=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),_l=new Map,Sl=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},Nl=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){this.changeListener=t,t(uc.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Dl=function(){function t(t){var e=this;this.oc=null,this.currentUser=uc.UNAUTHENTICATED,this.receivedInitialUser=!1,this.cc=0,this.changeListener=null,this.forceRefresh=!1,this.oc=function(){e.cc++,e.currentUser=e.uc(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.cc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.oc):(this.oc(null),t.get().then((function(t){e.auth=t,e.oc&&e.auth.addAuthTokenListener(e.oc)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.cc!==e?(Cr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Mr("string"==typeof n.accessToken),new Sl(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.oc),this.oc=null,this.changeListener=null},t.prototype.uc=function(){var t=this.auth&&this.auth.getUid();return Mr(null===t||"string"==typeof t),new uc(t)},t}(),Al=function(){function t(t,e){this.ac=t,this.hc=e,this.type="FirstParty",this.user=uc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.hc},e=this.ac.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),t}(),Ol=function(){function t(t,e){this.ac=t,this.hc=e}return t.prototype.getToken=function(){return Promise.resolve(new Al(this.ac,this.hc))},t.prototype.setChangeListener=function(t){t(uc.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function kl(t,e,n){if(!n)throw new Ar(Dr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Cl(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Ar(Dr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function xl(t,e,n,r){if(!0===e&&!0===r)throw new Ar(Dr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Rl(t){if(!ci.isDocumentKey(t))throw new Ar(Dr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Pl(t){if(ci.isDocumentKey(t))throw new Ar(Dr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Ll(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Lr()}function Ml(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Ar(Dr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Ll(t);throw new Ar(Dr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function Fl(t,e){if(e<=0)throw new Ar(Dr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var ql=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Ar(Dr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Ar(Dr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,xl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),Ul=function(){function t(t,e){this._persistenceKey="(lite)",this._settings=new ql({}),this._settingsFrozen=!1,t instanceof Tl?(this._databaseId=t,this._credentials=new Nl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Ar(Dr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Tl(t.options.projectId)}(t),this._credentials=new Dl(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new Ar(Dr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Ar(Dr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ql(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Nl;switch(t.type){case"gapi":var e=t.client;return Mr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Ol(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Ar(Dr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=_l.get(this))&&(Cr("ComponentProvider","Removing Datastore"),_l.delete(this),t.terminate()),Promise.resolve();var t},t}(),Vl=function(){function t(t,e,n){this._converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Bl(this.firestore,this._converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),jl=function(){function t(t,e,n){this._converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Bl=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,Hi(r))||this).firestore=e,i._path=r,i.type="collection",i}return Er(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Vl(this.firestore,null,new ci(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(jl);function Kl(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(b.g)(t),kl("collection","path",e),t instanceof Ul)return Pl(n=Yr.fromString.apply(Yr,Sr([e],r))),new Bl(t,null,n);if(!(t instanceof Vl||t instanceof Bl))throw new Ar(Dr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Pl(n=Yr.fromString.apply(Yr,Sr([t.path],r)).child(Yr.fromString(e))),new Bl(t.firestore,null,n)}function Gl(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(b.g)(t),1===arguments.length&&(e=Ur.u()),kl("doc","path",e),t instanceof Ul)return Rl(n=Yr.fromString.apply(Yr,Sr([e],r))),new Vl(t,null,new ci(n));if(!(t instanceof Vl||t instanceof Bl))throw new Ar(Dr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Rl(n=t._path.child(Yr.fromString.apply(Yr,Sr([e],r)))),new Vl(t.firestore,t instanceof Bl?t._converter:null,new ci(n))}function zl(t,e){return t=Object(b.g)(t),e=Object(b.g)(e),(t instanceof Vl||t instanceof Bl)&&(e instanceof Vl||e instanceof Bl)&&t.firestore===e.firestore&&t.path===e.path&&t._converter===e._converter}function Ql(t,e){return t=Object(b.g)(t),e=Object(b.g)(e),t instanceof jl&&e instanceof jl&&t.firestore===e.firestore&&no(t._query,e._query)&&t._converter===e._converter}var Hl=function(){function t(){var t=this;this.lc=Promise.resolve(),this.fc=[],this.dc=!1,this.wc=[],this._c=null,this.mc=!1,this.yc=[],this.Zi=new Dc(this,"async_queue_retry"),this.gc=function(){var e=Sc();e&&Cr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=Sc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.gc)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this.dc},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ec(),this.Tc(t)},t.prototype.enterRestrictedMode=function(){if(!this.dc){this.dc=!0;var t=Sc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.gc)}},t.prototype.enqueue=function(t){return this.Ec(),this.dc?new Promise((function(t){})):this.Tc(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.fc.push(t),e.Ic()}))},t.prototype.Ic=function(){return Tr(this,void 0,void 0,(function(){var t,e=this;return _r(this,(function(n){switch(n.label){case 0:if(0===this.fc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.fc[0]()];case 2:return n.sent(),this.fc.shift(),this.Zi.reset(),[3,4];case 3:if(!Ta(t=n.sent()))throw t;return Cr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.fc.length>0&&this.Zi.ji((function(){return e.Ic()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Tc=function(t){var e=this,n=this.lc.then((function(){return e.mc=!0,t().catch((function(t){throw e._c=t,e.mc=!1,xr("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.mc=!1,t}))}));return this.lc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ec(),this.yc.indexOf(t)>-1&&(e=0);var i=oh.createAndSchedule(this,t,e,n,(function(t){return r.Ac(t)}));return this.wc.push(i),i},t.prototype.Ec=function(){this._c&&Lr()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Rc=function(){return Tr(this,void 0,void 0,(function(){var t;return _r(this,(function(e){switch(e.label){case 0:return[4,t=this.lc];case 1:e.sent(),e.label=2;case 2:if(t!==this.lc)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.bc=function(t){for(var e=0,n=this.wc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.vc=function(t){var e=this;return this.Rc().then((function(){e.wc.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e.wc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Rc()}))},t.prototype.Pc=function(t){this.yc.push(t)},t.prototype.Ac=function(t){var e=this.wc.indexOf(t);this.wc.splice(e,1)},t}();function Wl(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new ga,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var Yl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._queue=new Hl,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Er(e,t),e.prototype._terminate=function(){return this._firestoreClient||Jl(this),this._firestoreClient.terminate()},e}(Ul);function Xl(t){return t._firestoreClient||Jl(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Jl(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new El(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new hl(t._credentials,t._queue,r)}function $l(t,e,n){var r=this,i=new ga;return t.asyncQueue.enqueue((function(){return Tr(r,void 0,void 0,(function(){var r;return _r(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,ll(t,n)];case 1:return o.sent(),[4,fl(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===Dr.FAILED_PRECONDITION||t.code===Dr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}}))}))})).then((function(){return i.promise}))}function Zl(t){if(t._initialized||t._terminated)throw new Ar(Dr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var tf=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Ar(Dr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Jr(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),ef=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(Zr.fromBase64String(e))}catch(e){throw new Ar(Dr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(Zr.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),nf=function(t){this._methodName=t},rf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new Ar(Dr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Ar(Dr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Vr(this._lat,t._lat)||Vr(this._long,t._long)},t}(),of=/^__.*__$/,sf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new Lo(t,this.data,this.fieldMask,e,this.fieldTransforms):new Po(t,this.data,e,this.fieldTransforms)},t}(),af=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new Lo(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function uf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Lr()}}var cf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Vc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Sc",{get:function(){return this.settings.Sc},enumerable:!1,configurable:!0}),t.prototype.Dc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.Cc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Dc({path:n,Nc:!1});return r.xc(t),r},t.prototype.Fc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Dc({path:n,Nc:!1});return r.Vc(),r},t.prototype.kc=function(t){return this.Dc({path:void 0,Nc:!0})},t.prototype.Oc=function(t){return Of(t,this.settings.methodName,this.settings.$c||!1,this.path,this.settings.Mc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},t.prototype.Vc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.xc(this.path.get(t))},t.prototype.xc=function(t){if(0===t.length)throw this.Oc("Document fields must not be empty");if(uf(this.Sc)&&of.test(t))throw this.Oc('Document fields cannot begin and end with "__"')},t}(),hf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Nc(t)}return t.prototype.Lc=function(t,e,n,r){return void 0===r&&(r=!1),new cf({Sc:t,methodName:e,Mc:n,path:Jr.emptyPath(),Nc:!1,$c:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function lf(t){var e=t._freezeSettings(),n=Nc(t._databaseId);return new hf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function ff(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Lc(o.merge||o.mergeFields?2:0,e,n,i);Sf("Data must be an object, but it was:",s,r);var a,u,c=Tf(r,s);if(o.merge)a=new $r(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=Nf(e,f[l],n);if(!s.contains(d))throw new Ar(Dr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");kf(h,d)||h.push(d)}a=new $r(h),u=s.fieldTransforms.filter((function(t){return a.covers(t.field)}))}else a=null,u=s.fieldTransforms;return new sf(new Ei(c),a,u)}var df=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Er(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Sc)throw t.Oc(1===t.Sc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(nf);function pf(t,e,n){return new cf({Sc:3,Mc:e.settings.Mc,methodName:t._methodName,Nc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var yf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Er(e,t),e.prototype._toFieldTransform=function(t){return new _o(t.path,new vo)},e.prototype.isEqual=function(t){return t instanceof e},e}(nf),vf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Bc=n,r}return Er(e,t),e.prototype._toFieldTransform=function(t){var e=pf(this,t,!0),n=this.Bc.map((function(t){return Ef(t,e)})),r=new go(n);return new _o(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(nf),gf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Bc=n,r}return Er(e,t),e.prototype._toFieldTransform=function(t){var e=pf(this,t,!0),n=this.Bc.map((function(t){return Ef(t,e)})),r=new bo(n);return new _o(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(nf),mf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).qc=n,r}return Er(e,t),e.prototype._toFieldTransform=function(t){var e=new Io(t.R,ho(t.R,this.qc));return new _o(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(nf);function bf(t,e,n,r){var i=t.Lc(1,e,n);Sf("Data must be an object, but it was:",i,r);var o=[],s=Ei.empty();Qr(r,(function(t,r){var a=Af(e,t,n);r=Object(b.g)(r);var u=i.Fc(a);if(r instanceof df)o.push(a);else{var c=Ef(r,u);null!=c&&(o.push(a),s.set(a,c))}}));var a=new $r(o);return new af(s,a,i.fieldTransforms)}function wf(t,e,n,r,i,o){var s=t.Lc(1,e,n),a=[Nf(e,r,n)],u=[i];if(o.length%2!=0)throw new Ar(Dr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(Nf(e,o[c])),u.push(o[c+1]);for(var h=[],l=Ei.empty(),f=a.length-1;f>=0;--f)if(!kf(h,a[f])){var d=a[f],p=u[f];p=Object(b.g)(p);var y=s.Fc(d);if(p instanceof df)h.push(d);else{var v=Ef(p,y);null!=v&&(h.push(d),l.set(d,v))}}var g=new $r(h);return new af(l,g,s.fieldTransforms)}function If(t,e,n,r){return void 0===r&&(r=!1),Ef(n,t.Lc(r?4:3,e))}function Ef(t,e){if(_f(t=Object(b.g)(t)))return Sf("Unsupported field value:",e,t),Tf(t,e);if(t instanceof nf)return function(t,e){if(!uf(e.Sc))throw e.Oc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Oc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Nc&&4!==e.Sc)throw e.Oc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Ef(o[i],e.kc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(b.g)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ho(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Kr.fromDate(t);return{timestampValue:bs(e.R,n)}}if(t instanceof Kr)return n=new Kr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:bs(e.R,n)};if(t instanceof rf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof ef)return{bytesValue:ws(e.R,t._byteString)};if(t instanceof Vl){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Oc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Ts(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Oc("Unsupported field value: "+Ll(t))}(t,e)}function Tf(t,e){var n={};return Hr(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Qr(t,(function(t,r){var i=Ef(r,e.Cc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function _f(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Kr||t instanceof rf||t instanceof ef||t instanceof Vl||t instanceof nf)}function Sf(t,e,n){if(!_f(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=Ll(n);throw e.Oc("an object"===r?t+" a custom object":t+" "+r)}}function Nf(t,e,n){if((e=Object(b.g)(e))instanceof tf)return e._internalPath;if("string"==typeof e)return Af(t,e);throw Of("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Df=new RegExp("[~\\*/\\[\\]]");function Af(t,e,n){if(e.search(Df)>=0)throw Of("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(tf.bind.apply(tf,Sr([void 0],e.split(".")))))._internalPath}catch(r){throw Of("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Of(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new Ar(Dr.INVALID_ARGUMENT,(a+=". ")+t+u)}function kf(t,e){return t.some((function(t){return t.isEqual(e)}))}var Cf=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Vl(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new xf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.toProto())}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Rf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),xf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Er(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(Cf);function Rf(t,e){return"string"==typeof e?Af(t,e):e instanceof tf?e._internalPath:e._delegate._internalPath}var Pf=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Lf=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return Er(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Mf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.toProto(),t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Rf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(Cf),Mf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Er(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(Lf),Ff=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Pf(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new Mf(n._firestore,n._userDataWriter,r.key,r,new Pf(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query._converter))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Ar(Dr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map((function(e){return{type:"added",doc:new Mf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Pf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query._converter),oldIndex:-1,newIndex:n++}}))}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new Mf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Pf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query._converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:qf(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function qf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Lr()}}function Uf(t,e){return t instanceof Lf&&e instanceof Lf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Ff&&e instanceof Ff&&t._firestore===e._firestore&&Ql(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Vf(t){if(Yi(t)&&0===t.explicitOrderBy.length)throw new Ar(Dr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var jf=function(){};function Bf(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Kf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Uc=e,i.Qc=n,i.Kc=r,i.type="where",i}return Er(e,t),e.prototype._apply=function(t){var e=lf(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new Ar(Dr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Xf(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push(Yf(r,t,h[c]));a={arrayValue:{values:u}}}else a=Yf(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Xf(s,o),a=If(n,"where",s,"in"===o||"not-in"===o);var l=ki.create(i,o,a);return function(t,e){if(e.g()){var n=Ji(t);if(null!==n&&!n.isEqual(e.field))throw new Ar(Dr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Xi(t);null!==r&&Jf(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new Ar(Dr.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.Uc,this.Qc,this.Kc);return new jl(t.firestore,t._converter,function(t,e){var n=t.filters.concat([e]);return new zi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(jf),Gf=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Uc=e,r.jc=n,r.type="orderBy",r}return Er(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Ar(Dr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Ar(Dr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new ji(e,n);return function(t,e){if(null===Xi(t)){var n=Ji(t);null!==n&&Jf(0,n,e.field)}}(t,r),r}(t._query,this.Uc,this.jc);return new jl(t.firestore,t._converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new zi(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(jf),zf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Wc=n,i.Gc=r,i}return Er(e,t),e.prototype._apply=function(t){return new jl(t.firestore,t._converter,eo(t._query,this.Wc,this.Gc))},e}(jf),Qf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.zc=n,i.Hc=r,i}return Er(e,t),e.prototype._apply=function(t){var e=Wf(t,this.type,this.zc,this.Hc);return new jl(t.firestore,t._converter,function(t,e){return new zi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(jf),Hf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.zc=n,i.Hc=r,i}return Er(e,t),e.prototype._apply=function(t){var e=Wf(t,this.type,this.zc,this.Hc);return new jl(t.firestore,t._converter,function(t,e){return new zi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(jf);function Wf(t,e,n,r){if(n[0]=Object(b.g)(n[0]),n[0]instanceof Cf)return function(t,e,n,r,i){if(!r)throw new Ar(Dr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=Zi(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(vi(e,r.key));else{var c=r.data.field(u.field);if(ii(c))throw new Ar(Dr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new Ar(Dr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Ui(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=lf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Ar(Dr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Ar(Dr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!$i(t)&&-1!==c.indexOf("/"))throw new Ar(Dr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Yr.fromString(c));if(!ci.isDocumentKey(h))throw new Ar(Dr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new ci(h);a.push(vi(e,l))}else{var f=If(n,r,c);a.push(f)}}return new Ui(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function Yf(t,e,n){if("string"==typeof(n=Object(b.g)(n))){if(""===n)throw new Ar(Dr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!$i(e)&&-1!==n.indexOf("/"))throw new Ar(Dr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Yr.fromString(n));if(!ci.isDocumentKey(r))throw new Ar(Dr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return vi(t,new ci(r))}if(n instanceof Vl)return vi(t,n._key);throw new Ar(Dr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ll(n)+".")}function Xf(t,e){if(!Array.isArray(t)||0===t.length)throw new Ar(Dr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Ar(Dr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Jf(t,e,n){if(!n.isEqual(e))throw new Ar(Dr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var $f=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),hi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ni(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ri(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Lr()}},t.prototype.convertObject=function(t,e){var n=this,r={};return Qr(t.fields||{},(function(t,i){r[t]=n.convertValue(i,e)})),r},t.prototype.convertGeoPoint=function(t){return new rf(ni(t.latitude),ni(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=function t(e){var n=e.mapValue.fields.__previous_value__;return ii(n)?t(n):n}(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(oi(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=ei(t);return new Kr(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Yr.fromString(t);Mr(Hs(n));var r=new Tl(n.get(1),n.get(3)),i=new ci(n.popFirst(5));return r.isEqual(e)||xr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function Zf(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var td=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Er(e,t),e.prototype.convertBytes=function(t){return new ef(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Vl(this.firestore,null,e)},e}($f),ed=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=lf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=nd(t,this._firestore),i=Zf(r._converter,e,n),o=ff(this._dataReader,"WriteBatch.set",r._key,i,null!==r._converter,n);return this._mutations.push(o.toMutation(r._key,No.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=nd(t,this._firestore);return o="string"==typeof(e=Object(b.g)(e))||e instanceof tf?wf(this._dataReader,"WriteBatch.update",s._key,e,n,r):bf(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,No.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=nd(t,this._firestore);return this._mutations=this._mutations.concat(new jo(e._key,No.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new Ar(Dr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function nd(t,e){if((t=Object(b.g)(t)).firestore!==e)throw new Ar(Dr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var rd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Er(e,t),e.prototype.convertBytes=function(t){return new ef(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Vl(this.firestore,null,e)},e}($f);function id(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Ml(t,Vl);var o=Ml(t.firestore,Yl),s=lf(o);return sd(o,[("string"==typeof(e=Object(b.g)(e))||e instanceof tf?wf(s,"updateDoc",t._key,e,n,r):bf(s,"updateDoc",t._key,e)).toMutation(t._key,No.exists(!0))])}function od(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=Object(b.g)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||Wl(i[a])||(s=i[a],a++);var u,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(Wl(i[a])){var f=i[a];i[a]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[a+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[a+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof Vl)c=Ml(t.firestore,Yl),h=Hi(t._key.path),u={next:function(e){i[a]&&i[a](ad(c,t,e))},error:i[a+1],complete:i[a+2]};else{var d=Ml(t,jl);c=Ml(d.firestore,Yl),h=d._query;var p=new rd(c);u={next:function(t){i[a]&&i[a](new Ff(c,p,d,t))},error:i[a+1],complete:i[a+2]},Vf(t._query)}return function(t,e,n,r){var i=this,o=new al(r),s=new gh(e,o,n);return t.asyncQueue.enqueueAndForget((function(){return Tr(i,void 0,void 0,(function(){var e;return _r(this,(function(n){switch(n.label){case 0:return e=fh,[4,bl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))})),function(){o.Wo(),t.asyncQueue.enqueueAndForget((function(){return Tr(i,void 0,void 0,(function(){var e;return _r(this,(function(n){switch(n.label){case 0:return e=dh,[4,bl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))}))}}(Xl(c),h,l,u)}function sd(t,e){return function(t,e){var n=this,r=new ga;return t.asyncQueue.enqueueAndForget((function(){return Tr(n,void 0,void 0,(function(){var n;return _r(this,(function(i){switch(i.label){case 0:return n=Oh,[4,ml(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(Xl(t),e)}function ad(t,e,n){var r=n.docs.get(e._key),i=new rd(t);return new Lf(t,i,e._key,r,new Pf(n.hasPendingWrites,n.fromCache),e._converter)}var ud=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Er(e,t),e.prototype.get=function(e){var n=this,r=nd(e,this._firestore),i=new rd(this._firestore);return t.prototype.get.call(this,e).then((function(t){return new Lf(n._firestore,i,r._key,t._document,new Pf(!1,!1),r._converter)}))},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=lf(t)}return t.prototype.get=function(t){var e=this,n=nd(t,this._firestore),r=new td(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return Lr();var i=t[0];if(i.isFoundDocument())return new Cf(e._firestore,r,i.key,i,n._converter);if(i.isNoDocument())return new Cf(e._firestore,r,n._key,null,n._converter);throw Lr()}))},t.prototype.set=function(t,e,n){var r=nd(t,this._firestore),i=Zf(r._converter,e,n),o=ff(this._dataReader,"Transaction.set",r._key,i,null!==r._converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=nd(t,this._firestore);return o="string"==typeof(e=Object(b.g)(e))||e instanceof tf?wf(this._dataReader,"Transaction.update",s._key,e,n,r):bf(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=nd(t,this._firestore);return this._transaction.delete(e._key),this},t}());function cd(){if("undefined"==typeof Uint8Array)throw new Ar(Dr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function hd(){if("undefined"==typeof atob)throw new Ar(Dr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var ld=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return hd(),new t(ef.fromBase64String(e))},t.fromUint8Array=function(e){return cd(),new t(ef.fromUint8Array(e))},t.prototype.toBase64=function(){return hd(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return cd(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),fd=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Zl(t=Ml(t,Yl));var n=Xl(t),r=t._freezeSettings(),i=new sl;return $l(n,i,new il(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Zl(t=Ml(t,Yl));var e=Xl(t),n=t._freezeSettings(),r=new sl;return $l(e,r,new ol(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new Ar(Dr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new ga;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return Tr(e,void 0,void 0,(function(){var e;return _r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Tr(this,void 0,void 0,(function(){return _r(this,(function(e){switch(e.label){case 0:return wa.yt()?[4,wa.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}}))}))}(Cu(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._delegate)},t}(),dd=function(){function t(t,e,n){var r=this;this._delegate=e,this.Jc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof Tl||(this.Yc=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e){!function(t,e,n){var r=(t=Ml(t,Ul))._getSettings();"firestore.googleapis.com"!==r.host&&r.host!==e&&Rr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},r),{host:e+":"+n,ssl:!1}))}(this._delegate,t,e)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return Tr(e,void 0,void 0,(function(){var e,n;return _r(this,(function(r){switch(r.label){case 0:return[4,yl(t)];case 1:return e=r.sent(),[4,gl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=Fr(t);return e.$r.delete(0),Pc(e)}(n))]}}))}))}))}(Xl(Ml(this._delegate,Yl)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return Tr(e,void 0,void 0,(function(){var e,n;return _r(this,(function(r){switch(r.label){case 0:return[4,yl(t)];case 1:return e=r.sent(),[4,gl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Tr(this,void 0,void 0,(function(){var e;return _r(this,(function(n){switch(n.label){case 0:return(e=Fr(t)).$r.add(0),[4,Lc(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(Xl(Ml(this._delegate,Yl)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&xl("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Jc.enableMultiTabIndexedDbPersistence(this):this.Jc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Jc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.Yc&&(this.Yc._removeServiceInstance("firestore"),this.Yc._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new ga;return t.asyncQueue.enqueueAndForget((function(){return Tr(e,void 0,void 0,(function(){var e;return _r(this,(function(r){switch(r.label){case 0:return e=Lh,[4,ml(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(Xl(Ml(this._delegate,Yl)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new al(e);return t.asyncQueue.enqueueAndForget((function(){return Tr(n,void 0,void 0,(function(){var e;return _r(this,(function(n){switch(n.label){case 0:return e=function(t,e){Fr(t).Gr.add(e),e.next()},[4,bl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))})),function(){r.Wo(),t.asyncQueue.enqueueAndForget((function(){return Tr(n,void 0,void 0,(function(){var e;return _r(this,(function(n){switch(n.label){case 0:return e=function(t,e){Fr(t).Gr.delete(e)},[4,bl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))}))}}(Xl(t=Ml(t,Yl)),Wl(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Yc)throw new Ar(Dr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Yc},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Dd(this,Kl(this._delegate,t))}catch(t){throw bd(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new md(this,Gl(this._delegate,t))}catch(t){throw bd(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new _d(this,function(t,e){if(t=Ml(t,Ul),kl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Ar(Dr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new jl(t,null,function(t){return new zi(Yr.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw bd(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new ga;return t.asyncQueue.enqueueAndForget((function(){return Tr(n,void 0,void 0,(function(){var n;return _r(this,(function(i){switch(i.label){case 0:return[4,function(t){return pl(t).then((function(t){return t.datastore}))}(t)];case 1:return n=i.sent(),new cl(t.asyncQueue,n,e,r).run(),[2]}}))}))})),r.promise}(Xl(t),(function(n){return e(new ud(t,n))}))}(this._delegate,(function(n){return t(new yd(e,n))}))},t.prototype.batch=function(){var t=this;return Xl(this._delegate),new vd(new ed(this._delegate,(function(e){return sd(t._delegate,e)})))},t.prototype.loadBundle=function(t){throw new Ar(Dr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new Ar(Dr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),pd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Er(e,t),e.prototype.convertBytes=function(t){return new ld(new ef(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return md.Xc(e,this.firestore,null)},e}($f),yd=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new pd(t)}return t.prototype.get=function(t){var e=this,n=Ad(t);return this._delegate.get(n).then((function(t){return new Ed(e._firestore,new Lf(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n._converter))}))},t.prototype.set=function(t,e,n){var r=Ad(t);return n?(Cl("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Ad(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Sr([s,e,n],i)),this},t.prototype.delete=function(t){var e=Ad(t);return this._delegate.delete(e),this},t}(),vd=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=Ad(t);return n?(Cl("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Ad(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Sr([s,e,n],i)),this},t.prototype.delete=function(t){var e=Ad(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),gd=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Mf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Td(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.Zc=function(e,n){var r=t.tu,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new pd(e),n),i.set(n,o)),o},t}();gd.tu=new WeakMap;var md=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new pd(t)}return t.eu=function(e,n,r){if(e.length%2!=0)throw new Ar(Dr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Vl(n._delegate,r,new ci(e)))},t.Xc=function(e,n,r){return new t(n,new Vl(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Dd(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Dd(this.firestore,Kl(this._delegate,t))}catch(t){throw bd(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object(b.g)(t))instanceof Vl&&zl(this._delegate,t)},t.prototype.set=function(t,e){e=Cl("DocumentReference.set",e);try{return function(t,e,n){t=Ml(t,Vl);var r=Ml(t.firestore,Yl),i=Zf(t._converter,e,n);return sd(r,[ff(lf(r),"setDoc",t._key,i,null!==t._converter,n).toMutation(t._key,No.none())])}(this._delegate,t,e)}catch(t){throw bd(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?id(this._delegate,t):id.apply(void 0,Sr([this._delegate,t,e],n))}catch(t){throw bd(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return sd(Ml((t=this._delegate).firestore,Yl),[new jo(t._key,No.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=wd(e),i=Id(e,(function(e){return new Ed(t.firestore,new Lf(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate._converter))}));return od(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Ml(t,Vl);var e=Ml(t.firestore,Yl),n=Xl(e),r=new rd(e);return function(t,e){var n=this,r=new ga;return t.asyncQueue.enqueueAndForget((function(){return Tr(n,void 0,void 0,(function(){var n;return _r(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return Tr(this,void 0,void 0,(function(){var r,i;return _r(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=Fr(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Mn.mn(t,e)}))}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new Ar(Dr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=sh(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}}))}))},[4,vl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._key).then((function(n){return new Lf(e,r,t._key,n,new Pf(null!==n&&n.hasLocalMutations,!0),t._converter)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Ml(t,Vl);var e=Ml(t.firestore,Yl);return wl(Xl(e),t._key,{source:"server"}).then((function(n){return ad(e,t,n)}))}(this._delegate):function(t){t=Ml(t,Vl);var e=Ml(t.firestore,Yl);return wl(Xl(e),t._key).then((function(n){return ad(e,t,n)}))}(this._delegate)).then((function(t){return new Ed(e.firestore,new Lf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate._converter))}))},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?gd.Zc(this.firestore,e):null))},t}();function bd(t,e,n){return t.message=t.message.replace(e,n),t}function wd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!Wl(r))return r}return{}}function Id(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=Wl(t[0])?t[0]:Wl(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var Ed=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new md(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Uf(this._delegate,t._delegate)},t}(),Td=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Er(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(Ed),_d=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new pd(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Bf(this._delegate,function(t,e,n){var r=e,i=Rf("where",t);return new Kf(i,r,n)}(e,n,r)))}catch(e){throw bd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Bf(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Rf("orderBy",t);return new Gf(r,n)}(e,n)))}catch(e){throw bd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Bf(this._delegate,function(t){return Fl("limit",t),new zf("limit",t,"F")}(e)))}catch(e){throw bd(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Bf(this._delegate,function(t){return Fl("limitToLast",t),new zf("limitToLast",t,"L")}(e)))}catch(e){throw bd(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Bf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Qf("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw bd(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Bf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Qf("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw bd(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Bf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Hf("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw bd(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Bf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Hf("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw bd(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return Ql(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Ml(t,jl);var e=Ml(t.firestore,Yl),n=Xl(e),r=new rd(e);return function(t,e){var n=this,r=new ga;return t.asyncQueue.enqueueAndForget((function(){return Tr(n,void 0,void 0,(function(){var n;return _r(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return Tr(this,void 0,void 0,(function(){var r,i,o,s,a;return _r(this,(function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,Qu(t,e,!0)];case 1:return a=u.sent(),r=new Eh(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=sh(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}}))}))},[4,vl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._query).then((function(n){return new Ff(e,r,t,n)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Ml(t,jl);var e=Ml(t.firestore,Yl),n=Xl(e),r=new rd(e);return Il(n,t._query,{source:"server"}).then((function(n){return new Ff(e,r,t,n)}))}(this._delegate):function(t){t=Ml(t,jl);var e=Ml(t.firestore,Yl),n=Xl(e),r=new rd(e);return Vf(t._query),Il(n,t._query).then((function(n){return new Ff(e,r,t,n)}))}(this._delegate)).then((function(t){return new Nd(e.firestore,new Ff(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=wd(e),i=Id(e,(function(e){return new Nd(t.firestore,new Ff(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return od(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?gd.Zc(this.firestore,e):null))},t}(),Sd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new Td(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),Nd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new _d(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new Td(t._firestore,e)}))},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new Sd(e._firestore,t)}))},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new Td(n._firestore,r))}))},t.prototype.isEqual=function(t){return Uf(this._delegate,t._delegate)},t}(),Dd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Er(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new md(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new md(this.firestore,void 0===t?Gl(this._delegate):Gl(this._delegate,t))}catch(t){throw bd(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=Ml(t.firestore,Yl),r=Gl(t),i=Zf(t._converter,e);return sd(n,[ff(lf(t.firestore),"addDoc",r._key,i,null!==t._converter,{}).toMutation(r._key,No.exists(!1))]).then((function(){return r}))}(this._delegate,t).then((function(t){return new md(e.firestore,t)}))},e.prototype.isEqual=function(t){return zl(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?gd.Zc(this.firestore,t):null))},e}(_d);function Ad(t){return Ml(t,Vl)}var Od,kd=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(tf.bind.apply(tf,Sr([void 0],t)))}return t.documentId=function(){return new t(Jr.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object(b.g)(t))instanceof tf&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Cd=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new yf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new df("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new vf("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new gf("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new mf("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),xd=n("QoMx"),Rd={Firestore:dd,GeoPoint:rf,Timestamp:Kr,Blob:ld,Transaction:yd,WriteBatch:vd,DocumentReference:md,DocumentSnapshot:Ed,Query:_d,QueryDocumentSnapshot:Td,QuerySnapshot:Nd,CollectionReference:Dd,FieldPath:kd,FieldValue:Cd,setLogLevel:function(t){Or.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new xd.a("firestore",(function(t){return function(t,e){return new dd(t,new Yl(t,e),new fd)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},Rd)))})(Od=m.a),Od.registerVersion("@firebase/firestore","2.2.2"),n("fQLH"),n("gQst"),n("AouM"),n("AqJ0"),n("2Mvu"),n("bacK");const Pd=new r.t("angularfire2.auth.use-emulator");function Ld(t,e){return function(t,e=i.b){return new o.a(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function Md(t,e){return Ld(t,e).pipe(Object(h.a)(t=>({payload:t,type:"query"})))}function Fd(t,e){return Md(t,e).pipe(Object(u.a)(void 0),Object(c.a)(),Object(h.a)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,i)=>{const o=n.find(t=>t.doc.ref.isEqual(e.ref)),s=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(e.metadata)||!o&&s&&JSON.stringify(s.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:e}})}),r}))}function qd(t,e,n){return Fd(t,n).pipe(Object(l.a)((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return Ud(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return Ud(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Ud(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),Object(f.a)(),Object(h.a)(t=>t.map(t=>({type:t.type,payload:t}))))}function Ud(t,e,n,...r){const i=t.slice();return i.splice(e,n,...r),i}function Vd(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}class jd{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=Fd(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Object(h.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe(Object(u.a)(void 0),Object(c.a)(),Object(d.a)(([t,e])=>e.length>0||!t),Object(h.a)(([t,e])=>e),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(l.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=Vd(t);return qd(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Md(this.query,this.afs.schedulers.outsideAngular).pipe(Object(h.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(s.a)(this.query.get(t)).pipe(Object(p.b)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new Bd(this.ref.doc(t),this.afs)}}class Bd{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:i}=Wd(n,e);return new jd(r,i,this.afs)}snapshotChanges(){return Ld(this.ref,this.afs.schedulers.outsideAngular).pipe(Object(u.a)(void 0),Object(c.a)(),Object(h.a)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"})).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe(Object(h.a)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Object(s.a)(this.ref.get(t)).pipe(Object(p.b)(this.afs.schedulers.insideAngular))}}class Kd{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?Fd(this.query,this.afs.schedulers.outsideAngular).pipe(Object(h.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)),Object(d.a)(t=>t.length>0),this.afs.keepUnstableUntilFirst):Fd(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(l.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=Vd(t);return qd(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Md(this.query,this.afs.schedulers.outsideAngular).pipe(Object(h.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(s.a)(this.query.get(t)).pipe(Object(p.b)(this.afs.schedulers.insideAngular))}}const Gd=new r.t("angularfire2.enableFirestorePersistence"),zd=new r.t("angularfire2.firestore.persistenceSettings"),Qd=new r.t("angularfire2.firestore.settings"),Hd=new r.t("angularfire2.firestore.use-emulator");function Wd(t,e=(t=>t)){return{query:e(t),ref:t}}let Yd=(()=>{class t{constructor(t,e,n,r,i,o,u,c,h){this.schedulers=new y.d(o),this.keepUnstableUntilFirst=Object(y.h)(this.schedulers);const l=Object(y.g)(t,o,e);!g.a.auth&&h&&Object(y.j)();const f=c;[this.firestore,this.persistenceEnabled$]=Object(y.f)(l.name+".firestore","AngularFirestore",l,()=>{const t=o.runOutsideAngular(()=>l.firestore());if(r&&t.settings(r),f&&t.useEmulator(...f),n&&!Object(v.y)(i)){const e=()=>{try{return Object(s.a)(t.enablePersistence(u||void 0).then(()=>!0,()=>!1))}catch(Od){return"undefined"!=typeof console&&console.warn(Od),Object(a.a)(!1)}};return[t,o.runOutsideAngular(e)]}return[t,Object(a.a)(!1)]},[r,f,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:i}=Wd(n,e),o=this.schedulers.ngZone.run(()=>r);return new jd(o,i,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new Kd(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new Bd(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(r.ic(y.c),r.ic(y.b,8),r.ic(Gd,8),r.ic(Qd,8),r.ic(r.H),r.ic(r.E),r.ic(zd,8),r.ic(Hd,8),r.ic(Pd,8))},t.\u0275prov=Object(r.Ub)({factory:function(){return new t(Object(r.ic)(y.c),Object(r.ic)(y.b,8),Object(r.ic)(Gd,8),Object(r.ic)(Qd,8),Object(r.ic)(r.H),Object(r.ic)(r.E),Object(r.ic)(zd,8),Object(r.ic)(Hd,8),Object(r.ic)(Pd,8))},token:t,providedIn:"any"}),t})(),Xd=(()=>{class t{static enablePersistence(e){return{ngModule:t,providers:[{provide:Gd,useValue:!0},{provide:zd,useValue:e}]}}}return t.\u0275mod=r.Wb({type:t}),t.\u0275inj=r.Vb({factory:function(e){return new(e||t)},providers:[Yd]}),t})()}}]);